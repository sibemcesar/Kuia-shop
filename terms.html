<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuia+ Shop - Painel Administrativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4845BE'
                    }
                }
            }
        }
    </script>
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">Kuia+ Shop Admin</h2>
            <p id="loadingStatus" class="text-gray-600 dark:text-gray-400">Carregando...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-40 hidden">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 border border-gray-200 dark:border-gray-700">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-2">🛡️ Painel Admin</h1>
                <p class="text-gray-600 dark:text-gray-400">Kuia+ Shop</p>
                <p class="text-sm text-gray-500 dark:text-gray-500 mt-2">Acesso restrito a administradores</p>
            </div>

            <!-- Admin Login Options -->
            <div class="space-y-4">
                <!-- Google Login -->
                <button id="googleLoginBtn" class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors flex items-center justify-center space-x-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Entrar com Google</span>
                </button>

                <!-- Email/Password Login -->
                <form id="loginForm" class="space-y-3">
                    <input type="email" id="loginEmail" placeholder="Email do administrador" required
                           class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                    <input type="password" id="loginPassword" placeholder="Senha" required
                           class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                    <button type="submit" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-primary-dark transition-colors">
                        Entrar no Painel
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Access Denied Screen -->
    <div id="accessDeniedScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-40 hidden">
        <div class="text-center max-w-md mx-4">
            <div class="text-6xl mb-4">🚫</div>
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">Acesso Negado</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Você não tem permissão para acessar o painel administrativo.</p>
            <button id="backToLoginBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                Voltar ao Login
            </button>
        </div>
    </div>

    <!-- Main Admin App -->
    <div id="adminApp" class="hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold text-primary">Kuia+ Shop Admin</h1>
                        <div class="hidden md:flex space-x-6">
                            <button id="dashboardBtn" class="nav-btn text-primary px-3 py-2 rounded-md text-sm font-medium">
                                <span class="mr-2">📊</span>Dashboard
                            </button>
                            <button id="productsBtn" class="nav-btn text-gray-700 dark:text-gray-300 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">
                                <span class="mr-2">📦</span>Produtos
                            </button>
                            <button id="ordersBtn" class="nav-btn text-gray-700 dark:text-gray-300 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">
                                <span class="mr-2">🛒</span>Pedidos
                            </button>
                            <button id="categoriesBtn" class="nav-btn text-gray-700 dark:text-gray-300 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">
                                <span class="mr-2">📂</span>Categorias
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- User Info -->
                        <div class="flex items-center space-x-2">
                            <img id="adminAvatar" src="" alt="Admin" class="w-8 h-8 rounded-full">
                            <span id="adminName" class="hidden sm:block text-sm font-medium text-gray-700 dark:text-gray-300"></span>
                        </div>
                        
                        <!-- Logout -->
                        <button id="logoutBtn" class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                            <span class="mr-1">🚪</span>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Navigation -->
        <div class="md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
            <div class="flex">
                <button id="mobileDashboardBtn" class="flex-1 nav-btn text-center py-3 text-primary">
                    <div class="text-lg">📊</div>
                    <span class="text-xs mt-1">Dashboard</span>
                </button>
                <button id="mobileProductsBtn" class="flex-1 nav-btn text-center py-3 text-gray-700 dark:text-gray-300 hover:text-primary">
                    <div class="text-lg">📦</div>
                    <span class="text-xs mt-1">Produtos</span>
                </button>
                <button id="mobileOrdersBtn" class="flex-1 nav-btn text-center py-3 text-gray-700 dark:text-gray-300 hover:text-primary">
                    <div class="text-lg">🛒</div>
                    <span class="text-xs mt-1">Pedidos</span>
                </button>
                <button id="mobileCategoriesBtn" class="flex-1 nav-btn text-center py-3 text-gray-700 dark:text-gray-300 hover:text-primary">
                    <div class="text-lg">📂</div>
                    <span class="text-xs mt-1">Categorias</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Section -->
            <div id="dashboardSection">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-8">Dashboard</h2>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900">
                                <span class="text-2xl">📦</span>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Produtos</p>
                                <p id="totalProducts" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 dark:bg-green-900">
                                <span class="text-2xl">🛒</span>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Pedidos Pendentes</p>
                                <p id="pendingOrders" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 dark:bg-yellow-900">
                                <span class="text-2xl">💰</span>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Vendas Hoje</p>
                                <p id="todaySales" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0 Kz</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900">
                                <span class="text-2xl">📂</span>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Categorias</p>
                                <p id="totalCategories" class="text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Pedidos Recentes</h3>
                    </div>
                    <div id="recentOrdersList" class="p-6">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                            <p class="text-gray-500 dark:text-gray-400">Carregando pedidos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="productsSection" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Gerenciar Produtos</h2>
                    <button id="addProductBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <span class="mr-2">➕</span>Adicionar Produto
                    </button>
                </div>

                <!-- Products List -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Lista de Produtos</h3>
                            <input type="text" id="productSearch" placeholder="Buscar produtos..." 
                                   class="w-64 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    <div id="productsList" class="p-6">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                            <p class="text-gray-500 dark:text-gray-400">Carregando produtos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="ordersSection" class="hidden">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-8">Gerenciar Pedidos</h2>

                <!-- Orders Filters -->
                <div class="mb-6 flex flex-wrap gap-2">
                    <button class="order-filter-btn bg-primary text-white px-4 py-2 rounded-full text-sm font-medium" data-status="all">
                        Todos
                    </button>
                    <button class="order-filter-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-full text-sm font-medium" data-status="pending">
                        Pendentes
                    </button>
                    <button class="order-filter-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-full text-sm font-medium" data-status="approved">
                        Aprovados
                    </button>
                    <button class="order-filter-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-full text-sm font-medium" data-status="rejected">
                        Rejeitados
                    </button>
                </div>

                <!-- Orders List -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Lista de Pedidos</h3>
                    </div>
                    <div id="ordersList" class="p-6">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                            <p class="text-gray-500 dark:text-gray-400">Carregando pedidos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesSection" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Gerenciar Categorias</h2>
                    <button id="addCategoryBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <span class="mr-2">➕</span>Adicionar Categoria
                    </button>
                </div>

                <!-- Categories List -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Lista de Categorias</h3>
                    </div>
                    <div id="categoriesList" class="p-6">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                            <p class="text-gray-500 dark:text-gray-400">Carregando categorias...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <h3 id="productModalTitle" class="text-xl font-semibold text-gray-800 dark:text-gray-200">Adicionar Produto</h3>
                    <button id="closeProductModalBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        ❌
                    </button>
                </div>

                <form id="productForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Product Image Upload -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Imagem do Produto</label>
                            <div class="flex items-center space-x-4">
                                <img id="productImagePreview" src="https://via.placeholder.com/100?text=📷" alt="Preview" 
                                     class="w-20 h-20 rounded-lg object-cover border-2 border-gray-300 dark:border-gray-600">
                                <div>
                                    <input type="file" id="productImageInput" accept="image/*" class="hidden">
                                    <label for="productImageInput" class="bg-primary text-white px-4 py-2 rounded cursor-pointer hover:bg-primary-dark">
                                        Escolher Imagem
                                    </label>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Formatos: JPG, PNG, GIF</p>
                                </div>
                            </div>
                        </div>

                        <!-- Product Name -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome do Produto *</label>
                            <input type="text" id="productName" required
                                   class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Categoria *</label>
                            <select id="productCategory" required
                                    class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione uma categoria</option>
                                <option value="eletronicos">Eletrônicos</option>
                                <option value="roupas">Roupas</option>
                                <option value="casa">Casa e Jardim</option>
                                <option value="livros">Livros</option>
                                <option value="esportes">Esportes</option>
                                <option value="beleza">Beleza</option>
                                <option value="acessorios">Acessórios & Joias</option>
                                <option value="calcados">Calçados</option>
                                <option value="alimentacao">Alimentação & Bebidas</option>
                                <option value="saude">Saúde & Bem-estar</option>
                                <option value="automotivo">Automotivo</option>
                                <option value="brinquedos">Brinquedos & Jogos</option>
                                <option value="musica">Música & Instrumentos</option>
                                <option value="arte">Arte & Artesanato</option>
                                <option value="pets">Pets</option>
                                <option value="servicos">Serviços</option>
                            </select>
                        </div>

                        <!-- Stock -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Estoque *</label>
                            <input type="number" id="productStock" required min="0"
                                   class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <!-- Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Preço (Kz) *</label>
                            <input type="number" id="productPrice" required min="0" step="0.01"
                                   class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <!-- Old Price (for discounts) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Preço Antigo (Kz)</label>
                            <input type="number" id="productOldPrice" min="0" step="0.01"
                                   class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <!-- Description -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Descrição</label>
                            <textarea id="productDescription" rows="3"
                                      class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelProductBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" id="saveProductBtn" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                            <span id="saveProductText">Salvar Produto</span>
                            <span id="saveProductLoader" class="hidden">
                                <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                                Salvando...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="orderDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <h3 id="orderDetailTitle" class="text-xl font-semibold text-gray-800 dark:text-gray-200">Detalhes do Pedido</h3>
                    <button id="closeOrderDetailBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        ❌
                    </button>
                </div>

                <div id="orderDetailContent">
                    <!-- Content will be populated dynamically -->
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button id="rejectOrderBtn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                        Rejeitar
                    </button>
                    <button id="approveOrderBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                        Aprovar
                    </button>
                    <button id="deleteOrderBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                        Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        console.log('🚀 Iniciando Kuia+ Shop Admin...');
        document.getElementById('loadingStatus').textContent = 'Carregando Firebase...';

        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';
        import { getDatabase, ref, onValue, push, set, remove, update } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, updateDoc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js';

        console.log('✅ Firebase modules loaded');
        document.getElementById('loadingStatus').textContent = 'Conectando ao Firebase...';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyArmhNnjraGaY017AP5uRcM8w0WWditrIs",
            authDomain: "kuia-shop.firebaseapp.com",
            projectId: "kuia-shop",
            storageBucket: "kuia-shop.appspot.com",
            messagingSenderId: "53786495493",
            appId: "1:53786495493:web:85fa67bd5de1d351b1ea6c",
            measurementId: "G-LTZ8VLN3LN"
        };

        // Initialize Firebase
        let app, auth, database, firestore;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            database = getDatabase(app);
            firestore = getFirestore(app);
            console.log('✅ Firebase initialized successfully');
            document.getElementById('loadingStatus').textContent = 'Firebase conectado!';
        } catch (error) {
            console.error('❌ Firebase initialization error:', error);
            document.getElementById('loadingStatus').textContent = 'Erro na conexão.';
        }

        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global variables
        let currentAdmin = null;
        let products = {};
        let orders = {};
        let categories = [];
        let currentSection = 'dashboard';
        let currentOrderFilter = 'all';
        let editingProductId = null;
        let currentOrderId = null;

        // API Key for image upload
        const apiKeyImgBB = 'e073e02267a1f0259cd69c562e780659';
        let uploadedImageURL = null;

        // DOM elements
        const loadingScreen = document.getElementById('loadingScreen');
        const loginScreen = document.getElementById('loginScreen');
        const accessDeniedScreen = document.getElementById('accessDeniedScreen');
        const adminApp = document.getElementById('adminApp');

        // Auth elements
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const loginForm = document.getElementById('loginForm');
        const backToLoginBtn = document.getElementById('backToLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        // Navigation elements
        const dashboardBtn = document.getElementById('dashboardBtn');
        const productsBtn = document.getElementById('productsBtn');
        const ordersBtn = document.getElementById('ordersBtn');
        const categoriesBtn = document.getElementById('categoriesBtn');
        const mobileDashboardBtn = document.getElementById('mobileDashboardBtn');
        const mobileProductsBtn = document.getElementById('mobileProductsBtn');
        const mobileOrdersBtn = document.getElementById('mobileOrdersBtn');
        const mobileCategoriesBtn = document.getElementById('mobileCategoriesBtn');

        // Section elements
        const dashboardSection = document.getElementById('dashboardSection');
        const productsSection = document.getElementById('productsSection');
        const ordersSection = document.getElementById('ordersSection');
        const categoriesSection = document.getElementById('categoriesSection');

        // Authentication
        googleLoginBtn.addEventListener('click', async () => {
            try {
                const provider = new GoogleAuthProvider();
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error('Login error:', error);
                showCustomAlert('Erro no login: ' + error.message);
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error('Login error:', error);
                showCustomAlert('Erro no login: ' + error.message);
            }
        });

        backToLoginBtn.addEventListener('click', () => {
            showLoginScreen();
        });

        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Authentication state observer
        onAuthStateChanged(auth, async (user) => {
            console.log('Auth state changed:', user);
            currentAdmin = user;
            
            if (user) {
                // Check if user is admin
                const isAdmin = await checkAdminStatus(user);
                if (isAdmin) {
                    updateAdminUI();
                    showAdminApp();
                    loadData();
                } else {
                    showAccessDenied();
                }
            } else {
                showLoginScreen();
            }
        });

        async function checkAdminStatus(user) {
            try {
                // Check if user is sibemcesar@gmail.com or in admins collection
                if (user.email === 'sibemcesar@gmail.com') {
                    return true;
                }
                
                const adminDoc = await getDoc(doc(firestore, 'admins', user.uid));
                return adminDoc.exists();
            } catch (error) {
                console.error('Error checking admin status:', error);
                return false;
            }
        }

        function updateAdminUI() {
            const adminAvatar = document.getElementById('adminAvatar');
            const adminName = document.getElementById('adminName');
            
            adminAvatar.src = currentAdmin.photoURL || 'https://via.placeholder.com/32?text=' + (currentAdmin.displayName?.charAt(0) || '👤');
            adminName.textContent = currentAdmin.displayName || currentAdmin.email;
        }

        // Navigation
        dashboardBtn.addEventListener('click', () => showSection('dashboard'));
        productsBtn.addEventListener('click', () => showSection('products'));
        ordersBtn.addEventListener('click', () => showSection('orders'));
        categoriesBtn.addEventListener('click', () => showSection('categories'));
        
        mobileDashboardBtn.addEventListener('click', () => showSection('dashboard'));
        mobileProductsBtn.addEventListener('click', () => showSection('products'));
        mobileOrdersBtn.addEventListener('click', () => showSection('orders'));
        mobileCategoriesBtn.addEventListener('click', () => showSection('categories'));

        function showSection(section) {
            currentSection = section;
            
            // Hide all sections
            dashboardSection.classList.add('hidden');
            productsSection.classList.add('hidden');
            ordersSection.classList.add('hidden');
            categoriesSection.classList.add('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-primary');
                btn.classList.add('text-gray-700', 'dark:text-gray-300');
            });
            
            // Show selected section and update nav
            switch (section) {
                case 'dashboard':
                    dashboardSection.classList.remove('hidden');
                    dashboardBtn?.classList.add('text-primary');
                    mobileDashboardBtn.classList.add('text-primary');
                    loadDashboardData();
                    break;
                case 'products':
                    productsSection.classList.remove('hidden');
                    productsBtn?.classList.add('text-primary');
                    mobileProductsBtn.classList.add('text-primary');
                    renderProducts();
                    break;
                case 'orders':
                    ordersSection.classList.remove('hidden');
                    ordersBtn?.classList.add('text-primary');
                    mobileOrdersBtn.classList.add('text-primary');
                    renderOrders();
                    break;
                case 'categories':
                    categoriesSection.classList.remove('hidden');
                    categoriesBtn?.classList.add('text-primary');
                    mobileCategoriesBtn.classList.add('text-primary');
                    renderCategories();
                    break;
            }
        }

        // Load data from Firebase
        function loadData() {
            // Load products
            const productsRef = ref(database, 'products');
            onValue(productsRef, (snapshot) => {
                products = snapshot.val() || {};
                console.log('Products loaded:', Object.keys(products).length);
                if (currentSection === 'products') {
                    renderProducts();
                }
            });

            // Load orders
            const ordersRef = ref(database, 'orders');
            onValue(ordersRef, (snapshot) => {
                orders = snapshot.val() || {};
                console.log('Orders loaded:', Object.keys(orders).length);
                if (currentSection === 'orders') {
                    renderOrders();
                }
            });
        }

        function loadDashboardData() {
            // Calculate stats
            const totalProducts = Object.keys(products).length;
            const ordersArray = Object.values(orders);
            const pendingOrders = ordersArray.filter(order => order.status === 'pending').length;
            const today = new Date().toDateString();
            const todaySales = ordersArray
                .filter(order => new Date(order.createdAt).toDateString() === today && order.status === 'approved')
                .reduce((sum, order) => sum + order.total, 0);
            const totalCategories = [...new Set(Object.values(products).map(p => p.category))].length;

            // Update dashboard stats
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('todaySales').textContent = formatPrice(todaySales);
            document.getElementById('totalCategories').textContent = totalCategories;

            // Load recent orders
            const recentOrders = ordersArray
                .sort((a, b) => b.createdAt - a.createdAt)
                .slice(0, 5);

            const recentOrdersList = document.getElementById('recentOrdersList');
            if (recentOrders.length === 0) {
                recentOrdersList.innerHTML = `
                    <div class="text-center py-8">
                        <p class="text-gray-500 dark:text-gray-400">Nenhum pedido encontrado</p>
                    </div>
                `;
            } else {
                recentOrdersList.innerHTML = recentOrders.map(order => `
                    <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-700 last:border-b-0">
                        <div>
                            <p class="font-medium text-gray-900 dark:text-gray-100">${order.customer.name}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${order.items.length} item(s) • ${formatPrice(order.total)}</p>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs rounded ${getStatusColor(order.status)}">
                                ${getStatusText(order.status)}
                            </span>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                ${new Date(order.createdAt).toLocaleDateString('pt-BR')}
                            </p>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Products Management
        const addProductBtn = document.getElementById('addProductBtn');
        const productModal = document.getElementById('productModal');
        const closeProductModalBtn = document.getElementById('closeProductModalBtn');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const productForm = document.getElementById('productForm');
        const productImageInput = document.getElementById('productImageInput');
        const productImagePreview = document.getElementById('productImagePreview');

        addProductBtn.addEventListener('click', () => {
            editingProductId = null;
            document.getElementById('productModalTitle').textContent = 'Adicionar Produto';
            productForm.reset();
            productImagePreview.src = 'https://via.placeholder.com/100?text=📷';
            uploadedImageURL = null;
            productModal.classList.remove('hidden');
        });

        closeProductModalBtn.addEventListener('click', closeProductModal);
        cancelProductBtn.addEventListener('click', closeProductModal);

        function closeProductModal() {
            productModal.classList.add('hidden');
            editingProductId = null;
            uploadedImageURL = null;
        }

        // Image upload functionality
        productImageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                productImagePreview.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // Upload to ImgBB
            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    uploadedImageURL = result.data.url;
                    console.log('Image uploaded successfully:', uploadedImageURL);
                } else {
                    showCustomAlert('Erro ao fazer upload da imagem.');
                }
            } catch (error) {
                console.error('Image upload error:', error);
                showCustomAlert('Erro ao fazer upload da imagem.');
            }
        });

        productForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const saveProductText = document.getElementById('saveProductText');
            const saveProductLoader = document.getElementById('saveProductLoader');
            const saveProductBtn = document.getElementById('saveProductBtn');
            
            // Show loading state
            saveProductText.classList.add('hidden');
            saveProductLoader.classList.remove('hidden');
            saveProductBtn.disabled = true;
            
            try {
                const productData = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    stock: parseInt(document.getElementById('productStock').value),
                    price: parseFloat(document.getElementById('productPrice').value),
                    oldPrice: parseFloat(document.getElementById('productOldPrice').value) || null,
                    description: document.getElementById('productDescription').value,
                    image: uploadedImageURL,
                    createdAt: editingProductId ? undefined : Date.now(),
                    updatedAt: Date.now()
                };

                if (editingProductId) {
                    // Update existing product
                    await update(ref(database, `products/${editingProductId}`), productData);
                    await updateDoc(doc(firestore, 'products', editingProductId), productData);
                    showCustomAlert('Produto atualizado com sucesso!');
                } else {
                    // Add new product
                    const newProductRef = push(ref(database, 'products'));
                    await set(newProductRef, productData);
                    await setDoc(doc(firestore, 'products', newProductRef.key), productData);
                    showCustomAlert('Produto adicionado com sucesso!');
                }
                
                closeProductModal();
            } catch (error) {
                console.error('Error saving product:', error);
                showCustomAlert('Erro ao salvar produto: ' + error.message);
            } finally {
                // Reset loading state
                saveProductText.classList.remove('hidden');
                saveProductLoader.classList.add('hidden');
                saveProductBtn.disabled = false;
            }
        });

        function renderProducts() {
            const productsList = document.getElementById('productsList');
            const productsArray = Object.entries(products).map(([id, product]) => ({ id, ...product }));
            
            if (productsArray.length === 0) {
                productsList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-4">📦</div>
                        <p class="text-gray-500 dark:text-gray-400">Nenhum produto cadastrado</p>
                    </div>
                `;
                return;
            }

            productsList.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                    ${productsArray.map(product => `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                            <div class="flex items-start space-x-4">
                                <img src="${product.image || 'https://via.placeholder.com/80?text=📷'}" alt="${product.name}" 
                                     class="w-20 h-20 rounded-lg object-cover">
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-semibold text-gray-900 dark:text-gray-100 truncate">${product.name}</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 capitalize">${getCategoryName(product.category)}</p>
                                    <p class="text-lg font-bold text-primary">${formatPrice(product.price)}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Estoque: ${product.stock}</p>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-2 mt-4">
                                <button onclick="editProduct('${product.id}')" 
                                        class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
                                    Editar
                                </button>
                                <button onclick="deleteProduct('${product.id}')" 
                                        class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">
                                    Excluir
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        window.editProduct = function(productId) {
            const product = products[productId];
            if (!product) return;

            editingProductId = productId;
            document.getElementById('productModalTitle').textContent = 'Editar Produto';
            
            // Fill form with product data
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productOldPrice').value = product.oldPrice || '';
            document.getElementById('productDescription').value = product.description || '';
            
            if (product.image) {
                productImagePreview.src = product.image;
                uploadedImageURL = product.image;
            } else {
                productImagePreview.src = 'https://via.placeholder.com/100?text=📷';
                uploadedImageURL = null;
            }
            
            productModal.classList.remove('hidden');
        };

        window.deleteProduct = function(productId) {
            showConfirmDialog('Tem certeza que deseja excluir este produto?', async () => {
                try {
                    await remove(ref(database, `products/${productId}`));
                    await deleteDoc(doc(firestore, 'products', productId));
                    showCustomAlert('Produto excluído com sucesso!');
                } catch (error) {
                    console.error('Error deleting product:', error);
                    showCustomAlert('Erro ao excluir produto: ' + error.message);
                }
            });
        };

        // Orders Management
        const orderDetailModal = document.getElementById('orderDetailModal');
        const closeOrderDetailBtn = document.getElementById('closeOrderDetailBtn');
        const approveOrderBtn = document.getElementById('approveOrderBtn');
        const rejectOrderBtn = document.getElementById('rejectOrderBtn');
        const deleteOrderBtn = document.getElementById('deleteOrderBtn');

        closeOrderDetailBtn.addEventListener('click', () => {
            orderDetailModal.classList.add('hidden');
            currentOrderId = null;
        });

        // Order filters
        document.querySelectorAll('.order-filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.order-filter-btn').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                });
                btn.classList.add('bg-primary', 'text-white');
                btn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                currentOrderFilter = btn.dataset.status;
                renderOrders();
            });
        });

        function renderOrders() {
            const ordersList = document.getElementById('ordersList');
            const ordersArray = Object.entries(orders).map(([id, order]) => ({ id, ...order }));
            
            let filteredOrders = ordersArray;
            if (currentOrderFilter !== 'all') {
                filteredOrders = ordersArray.filter(order => order.status === currentOrderFilter);
            }

            if (filteredOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-4">🛒</div>
                        <p class="text-gray-500 dark:text-gray-400">Nenhum pedido encontrado</p>
                    </div>
                `;
                return;
            }

            ordersList.innerHTML = `
                <div class="space-y-4">
                    ${filteredOrders
                        .sort((a, b) => b.createdAt - a.createdAt)
                        .map(order => `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-900 dark:text-gray-100">${order.customer.name}</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${order.customer.email}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${order.customer.phone}</p>
                                </div>
                                <div class="text-right">
                                    <span class="px-2 py-1 text-xs rounded ${getStatusColor(order.status)}">
                                        ${getStatusText(order.status)}
                                    </span>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                        ${new Date(order.createdAt).toLocaleDateString('pt-BR')}
                                    </p>
                                </div>
                            </div>
                            <div class="mb-3">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <strong>Itens:</strong> ${order.items.length} produto(s)
                                </p>
                                <p class="text-lg font-semibold text-primary">
                                    <strong>Total:</strong> ${formatPrice(order.total)}
                                </p>
                            </div>
                            <button onclick="showOrderDetail('${order.id}')" 
                                    class="px-4 py-2 bg-primary text-white text-sm rounded hover:bg-primary-dark">
                                Ver Detalhes
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        window.showOrderDetail = function(orderId) {
            const order = orders[orderId];
            if (!order) return;

            currentOrderId = orderId;
            document.getElementById('orderDetailTitle').textContent = `Pedido #${orderId.slice(-6)}`;
            
            const orderDetailContent = document.getElementById('orderDetailContent');
            orderDetailContent.innerHTML = `
                <div class="space-y-4">
                    <!-- Customer Info -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">Informações do Cliente</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                            <div>
                                <span class="font-medium">Nome:</span> ${order.customer.name}
                            </div>
                            <div>
                                <span class="font-medium">Email:</span> ${order.customer.email}
                            </div>
                            <div>
                                <span class="font-medium">Telefone:</span> ${order.customer.phone}
                            </div>
                            <div>
                                <span class="font-medium">Status:</span> 
                                <span class="px-2 py-1 text-xs rounded ${getStatusColor(order.status)}">
                                    ${getStatusText(order.status)}
                                </span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="font-medium">Endereço:</span>
                            <p class="text-gray-600 dark:text-gray-400">${order.customer.location}</p>
                        </div>
                        ${order.customer.message ? `
                            <div class="mt-3">
                                <span class="font-medium">Mensagem:</span>
                                <p class="text-gray-600 dark:text-gray-400">${order.customer.message}</p>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Order Items -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">Itens do Pedido</h4>
                        <div class="space-y-2">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0">
                                    <div>
                                        <span class="font-medium">${item.name}</span>
                                        <span class="text-gray-500 dark:text-gray-400">(${item.quantity}x)</span>
                                    </div>
                                    <span class="font-medium">${formatPrice(item.price * item.quantity)}</span>
                                </div>
                            `).join('')}
                            <div class="flex justify-between items-center pt-2 font-bold text-lg">
                                <span>Total:</span>
                                <span class="text-primary">${formatPrice(order.total)}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Order Date -->
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        Pedido realizado em: ${new Date(order.createdAt).toLocaleString('pt-BR')}
                    </div>
                </div>
            `;

            orderDetailModal.classList.remove('hidden');
        };

        approveOrderBtn.addEventListener('click', async () => {
            if (!currentOrderId) return;
            
            try {
                await update(ref(database, `orders/${currentOrderId}`), { status: 'approved' });
                await updateDoc(doc(firestore, 'orders', currentOrderId), { status: 'approved' });
                showCustomAlert('Pedido aprovado com sucesso!');
                orderDetailModal.classList.add('hidden');
            } catch (error) {
                console.error('Error approving order:', error);
                showCustomAlert('Erro ao aprovar pedido: ' + error.message);
            }
        });

        rejectOrderBtn.addEventListener('click', async () => {
            if (!currentOrderId) return;
            
            try {
                await update(ref(database, `orders/${currentOrderId}`), { status: 'rejected' });
                await updateDoc(doc(firestore, 'orders', currentOrderId), { status: 'rejected' });
                showCustomAlert('Pedido rejeitado com sucesso!');
                orderDetailModal.classList.add('hidden');
            } catch (error) {
                console.error('Error rejecting order:', error);
                showCustomAlert('Erro ao rejeitar pedido: ' + error.message);
            }
        });

        deleteOrderBtn.addEventListener('click', async () => {
            if (!currentOrderId) return;
            
            showConfirmDialog('Tem certeza que deseja excluir este pedido?', async () => {
                try {
                    await remove(ref(database, `orders/${currentOrderId}`));
                    await deleteDoc(doc(firestore, 'orders', currentOrderId));
                    showCustomAlert('Pedido excluído com sucesso!');
                    orderDetailModal.classList.add('hidden');
                } catch (error) {
                    console.error('Error deleting order:', error);
                    showCustomAlert('Erro ao excluir pedido: ' + error.message);
                }
            });
        });

        // Categories Management
        function renderCategories() {
            const categoriesList = document.getElementById('categoriesList');
            const productCategories = [...new Set(Object.values(products).map(p => p.category))];
            
            if (productCategories.length === 0) {
                categoriesList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-4">📂</div>
                        <p class="text-gray-500 dark:text-gray-400">Nenhuma categoria encontrada</p>
                    </div>
                `;
                return;
            }

            categoriesList.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${productCategories.map(category => {
                        const categoryProducts = Object.values(products).filter(p => p.category === category);
                        return `
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">${getCategoryIcon(category)}</div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900 dark:text-gray-100">${getCategoryName(category)}</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">${categoryProducts.length} produto(s)</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Utility functions
        function formatPrice(price) {
            return `${Math.round(price).toLocaleString('pt-AO')} Kz`;
        }

        function getCategoryName(category) {
            const categoryNames = {
                'eletronicos': 'Eletrônicos',
                'roupas': 'Roupas',
                'casa': 'Casa e Jardim',
                'livros': 'Livros',
                'esportes': 'Esportes',
                'beleza': 'Beleza',
                'acessorios': 'Acessórios & Joias',
                'calcados': 'Calçados',
                'alimentacao': 'Alimentação & Bebidas',
                'saude': 'Saúde & Bem-estar',
                'automotivo': 'Automotivo',
                'brinquedos': 'Brinquedos & Jogos',
                'musica': 'Música & Instrumentos',
                'arte': 'Arte & Artesanato',
                'pets': 'Pets',
                'servicos': 'Serviços'
            };
            return categoryNames[category] || category;
        }

        function getCategoryIcon(category) {
            const categoryIcons = {
                'eletronicos': '💻',
                'roupas': '👕',
                'casa': '🏠',
                'livros': '📚',
                'esportes': '⚽',
                'beleza': '💄',
                'acessorios': '💍',
                'calcados': '👟',
                'alimentacao': '🍔',
                'saude': '💊',
                'automotivo': '🚗',
                'brinquedos': '🧸',
                'musica': '🎸',
                'arte': '🎨',
                'pets': '🐶',
                'servicos': '🛠️'
            };
            return categoryIcons[category] || '🏷️';
        }

        function getStatusColor(status) {
            switch (status) {
                case 'pending':
                    return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                case 'approved':
                    return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                case 'rejected':
                    return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                default:
                    return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'pending':
                    return 'Pendente';
                case 'approved':
                    return 'Aprovado';
                case 'rejected':
                    return 'Rejeitado';
                default:
                    return 'Desconhecido';
            }
        }

        function showAdminApp() {
            loadingScreen.classList.add('hidden');
            loginScreen.classList.add('hidden');
            accessDeniedScreen.classList.add('hidden');
            adminApp.classList.remove('hidden');
        }

        function showLoginScreen() {
            loadingScreen.classList.add('hidden');
            accessDeniedScreen.classList.add('hidden');
            adminApp.classList.add('hidden');
            loginScreen.classList.remove('hidden');
        }

        function showAccessDenied() {
            loadingScreen.classList.add('hidden');
            loginScreen.classList.add('hidden');
            adminApp.classList.add('hidden');
            accessDeniedScreen.classList.remove('hidden');
        }

        // Custom alert and confirm functions
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">Cancelar</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="this.closest('.fixed').remove(); (${onConfirm})()">Confirmar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Initialize the admin app
        setTimeout(() => {
            if (!currentAdmin) {
                showLoginScreen();
            }
        }, 2000);
    </script>
    
</body>
</html>