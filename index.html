<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="GkSLzTU8K1ZZEUTQvKWOrUz10LpKNT47b7Oge1Cg89g" >
    <title>Kuia+ Shop - Loja Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4845BE',
                        'primary-light': '#7B7AE8'
                    },
                    animation: {
                        'slide-in-right': 'slideInRight 0.3s ease-out',
                        'slide-in-left': 'slideInLeft 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'fade-out': 'fadeOut 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                        'bounce-in': 'bounceIn 0.4s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'notification-slide': 'notificationSlide 0.5s ease-out'
                    },
                    keyframes: {
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        slideInLeft: {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-20px)', opacity: '0', maxHeight: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1', maxHeight: '500px' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(0)', opacity: '1', maxHeight: '500px' },
                            '100%': { transform: 'translateY(-20px)', opacity: '0', maxHeight: '0' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 5px rgba(93, 92, 222, 0.2)' },
                            '100%': { boxShadow: '0 0 20px rgba(93, 92, 222, 0.6)' }
                        },
                        notificationSlide: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* CSS Base para Modo Escuro e Transi√ß√µes */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        html {
            scroll-behavior: smooth;
        }

        .dark {
            color-scheme: dark;
        }

        /* Vari√°veis CSS para cores */
        :root {
            --primary: #5D5CDE;
            --primary-dark: #4845BE;
            --primary-light: #7B7AE8;
            --bg-light: #FFFFFF;
            --bg-dark: #181818;
            --card-light: #FFFFFF;
            --card-dark: #1F2937;
            --text-light: #1F2937;
            --text-dark: #F9FAFB;
            --border-light: #E5E7EB;
            --border-dark: #374151;
        }

        /* Tema Claro */
        body {
            background-color: var(--bg-light);
            color: var(--text-light);
        }

        /* Tema Escuro */
        .dark body {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        /* Cards e Containers */
        .card-bg {
            background-color: var(--card-light);
            border-color: var(--border-light);
        }

        .dark .card-bg {
            background-color: var(--card-dark);
            border-color: var(--border-dark);
        }

        /* Efeitos de Hover Melhorados */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .dark .hover-lift:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }

        /* Gradientes Din√¢micos */
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Bot√µes Modernos */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border: none;
            box-shadow: 0 4px 15px rgba(93, 92, 222, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(93, 92, 222, 0.4);
        }

        .btn-secondary {
            background: rgba(93, 92, 222, 0.1);
            border: 1px solid rgba(93, 92, 222, 0.2);
            color: var(--primary);
        }

        .dark .btn-secondary {
            background: rgba(93, 92, 222, 0.2);
            border: 1px solid rgba(93, 92, 222, 0.3);
        }

        /* Filtros Colaps√°veis */
        .filter-container {
            max-height: 500px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1;
        }

        .filter-container.collapsed {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Notifica√ß√µes Modernas */
        .notification {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .dark .notification {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Toggle Switch para Tema */
        .theme-switch {
            position: relative;
            width: 44px;
            height: 22px;
            background: #ccc;
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            flex-shrink: 0;
        }

        .theme-switch.dark {
            background: var(--primary);
        }

        .theme-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-switch.dark::before {
            transform: translateX(22px);
        }

        /* Anima√ß√µes de Loading */
        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            display: inline-block;
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        /* Line clamp para textos */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Melhor responsividade */
        @media (max-width: 768px) {
            .filter-container {
                max-height: 300px;
            }
            /* Ocultar Pedidos e Chat/Mensagens no mobile */
            #footerOrdersBtn,
            #footerChatBtn {
                display: none !important;
            }
            .footer-grid-responsive {
                grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
            }
        }

        /* ===== Footer Estilo Loja Online ===== */
        .shop-footer {
            background: linear-gradient(180deg, rgba(255,255,255,0.98) 0%, rgba(248,247,255,1) 100%);
            border-top: 1px solid rgba(93,92,222,0.08);
            box-shadow: 0 -4px 24px rgba(93,92,222,0.06), 0 -1px 4px rgba(0,0,0,0.03);
            padding: 0;
            transition: all 0.3s ease;
        }
        .dark .shop-footer {
            background: linear-gradient(180deg, rgba(24,24,24,0.98) 0%, rgba(18,18,30,1) 100%);
            border-top: 1px solid rgba(93,92,222,0.15);
            box-shadow: 0 -4px 24px rgba(0,0,0,0.3), 0 -1px 4px rgba(93,92,222,0.08);
        }
        .shop-footer .footer-nav-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 6px 0 10px;
            background: none;
            border: none;
            cursor: pointer;
            color: #9ca3af;
            transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        .dark .shop-footer .footer-nav-item {
            color: #6b7280;
        }
        .shop-footer .footer-nav-item .footer-icon-wrap {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 30px;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        .shop-footer .footer-nav-item.active .footer-icon-wrap {
            background: rgba(93,92,222,0.12);
            transform: scale(1.08);
        }
        .dark .shop-footer .footer-nav-item.active .footer-icon-wrap {
            background: rgba(93,92,222,0.22);
        }
        .shop-footer .footer-nav-item .footer-icon-wrap svg {
            width: 22px;
            height: 22px;
            stroke-width: 1.8;
            transition: all 0.25s ease;
        }
        .shop-footer .footer-nav-item.active .footer-icon-wrap svg {
            stroke-width: 2.4;
            filter: drop-shadow(0 1px 3px rgba(93,92,222,0.25));
        }
        .shop-footer .footer-nav-item .footer-label {
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 0.02em;
            line-height: 1;
            transition: all 0.25s ease;
            opacity: 0.7;
        }
        .shop-footer .footer-nav-item.active .footer-label {
            font-weight: 700;
            opacity: 1;
            color: var(--primary);
        }
        .shop-footer .footer-nav-item.active {
            color: var(--primary);
        }
        .shop-footer .footer-nav-item:not(.active):hover {
            color: var(--primary-light);
        }
        .shop-footer .footer-nav-item:not(.active):hover .footer-icon-wrap {
            background: rgba(93,92,222,0.06);
        }
        .dark .shop-footer .footer-nav-item:not(.active):hover .footer-icon-wrap {
            background: rgba(93,92,222,0.1);
        }
        /* Active indicator bar */
        .shop-footer .footer-nav-item .footer-active-bar {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 18px;
            height: 3px;
            border-radius: 3px 3px 0 0;
            background: var(--primary);
            transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        .shop-footer .footer-nav-item.active .footer-active-bar {
            transform: translateX(-50%) scaleX(1);
        }
        /* Cart badge e-commerce style */
        .shop-footer .footer-cart-badge {
            position: absolute;
            top: -3px;
            right: -8px;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #fff;
            font-size: 10px;
            font-weight: 800;
            border-radius: 9px;
            box-shadow: 0 2px 6px rgba(239,68,68,0.4);
            transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
            line-height: 1;
        }
        .shop-footer .footer-cart-badge.bounce-anim {
            animation: cartBadgeBounce 0.4s ease;
        }
        @keyframes cartBadgeBounce {
            0% { transform: scale(1); }
            30% { transform: scale(1.35); }
            60% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        /* Chat notification dot */
        .shop-footer .footer-chat-dot {
            position: absolute;
            top: 0;
            right: 2px;
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.95);
            animation: chatDotPulse 2s ease-in-out infinite;
        }
        .dark .shop-footer .footer-chat-dot {
            box-shadow: 0 0 0 2px rgba(24,24,24,0.95);
        }
        @keyframes chatDotPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }
        /* Press/tap effect */
        .shop-footer .footer-nav-item:active .footer-icon-wrap {
            transform: scale(0.9);
            transition-duration: 0.1s;
        }
        .shop-footer .footer-nav-item.active:active .footer-icon-wrap {
            transform: scale(1.02);
            transition-duration: 0.1s;
        }
        /* Safe area for iPhones */
        .shop-footer-safe {
            padding-bottom: env(safe-area-inset-bottom, 0px);
        }

        /* Estados de Focus melhorados */
        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.1);
            border-color: var(--primary);
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--border-light);
        }

        .dark ::-webkit-scrollbar-track {
            background: var(--border-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ===== Header Roxo ===== */
        .header-purple {
            background: linear-gradient(135deg, #6B21A8 0%, #7C3AED 40%, #9333EA 100%);
            border-color: rgba(255,255,255,0.12) !important;
            color: #fff;
        }
        .dark .header-purple {
            background: linear-gradient(135deg, #4C1D95 0%, #5B21B6 40%, #6D28D9 100%);
            border-color: rgba(255,255,255,0.08) !important;
        }
        .header-purple .btn-secondary {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
        }
        .header-purple .btn-secondary:hover {
            background: rgba(255,255,255,0.25);
        }
        .header-purple #userName {
            color: #fff;
        }
        .header-purple #userAvatar {
            border-color: rgba(255,255,255,0.6);
        }
        .header-purple .search-inline-container input {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.25);
            color: #fff;
        }
        .header-purple .search-inline-container input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        .header-purple .search-inline-container svg {
            color: rgba(255,255,255,0.5);
        }
        .header-purple .search-inline-container button {
            color: #fff;
        }
        .header-purple .search-inline-container button:hover {
            background: rgba(255,255,255,0.15);
        }

        /* ===== Category Cards com Imagem de Fundo ===== */
        .category-card-bg {
            position: relative;
            overflow: hidden;
            border: none;
            min-height: 200px;
            background-size: cover;
            background-position: center;
            border-radius: 1rem;
        }
        .category-card-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.55) 100%);
            z-index: 1;
            transition: background 0.3s ease;
        }
        .dark .category-card-bg::before {
            background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.7) 100%);
        }
        .category-card-bg:hover::before {
            background: linear-gradient(180deg, rgba(93,92,222,0.15) 0%, rgba(0,0,0,0.6) 100%);
        }
        .category-card-bg .category-card-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
            padding: 1.5rem;
        }
        .category-card-bg .category-card-content h3,
        .category-card-bg .category-card-content p {
            color: #fff !important;
            text-shadow: 0 1px 4px rgba(0,0,0,0.4);
        }
        .category-card-bg .category-card-content p {
            opacity: 0.85;
        }
        .category-card-bg .category-card-icon {
            width: 52px;
            height: 52px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.25);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
            transition: transform 0.3s ease, background 0.3s ease;
        }
        .category-card-bg:hover .category-card-icon {
            transform: scale(1.1);
            background: rgba(255,255,255,0.3);
        }

        /* Efeitos de ripple */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .ripple:active::before {
            width: 300px;
            height: 300px;
        }

        /* ===== Login Animations ===== */
        .login-particles {
            position: absolute; inset: 0; overflow: hidden; pointer-events: none;
        }
        .particle {
            position: absolute; border-radius: 50%; opacity: 0.15;
            background: rgba(255,255,255,0.6);
            animation: particleFloat 8s ease-in-out infinite;
        }
        .particle-1 { width:80px; height:80px; top:10%; left:5%; animation-delay:0s; }
        .particle-2 { width:50px; height:50px; top:60%; left:80%; animation-delay:1.5s; }
        .particle-3 { width:120px; height:120px; top:70%; left:15%; animation-delay:3s; }
        .particle-4 { width:40px; height:40px; top:20%; left:70%; animation-delay:4.5s; }
        .particle-5 { width:60px; height:60px; top:45%; left:50%; animation-delay:2s; }
        .particle-6 { width:90px; height:90px; top:80%; left:60%; animation-delay:5s; }
        @keyframes particleFloat {
            0%,100% { transform: translateY(0) scale(1); opacity: 0.1; }
            50% { transform: translateY(-40px) scale(1.15); opacity: 0.25; }
        }

        .login-card-entrance {
            animation: loginCardPop 0.6s cubic-bezier(0.34,1.56,0.64,1) forwards;
        }
        @keyframes loginCardPop {
            0% { opacity:0; transform:scale(0.85) translateY(30px); }
            100% { opacity:1; transform:scale(1) translateY(0); }
        }

        .login-logo-pulse {
            animation: logoPulse 2s ease-in-out infinite, float 3s ease-in-out infinite;
        }
        @keyframes logoPulse {
            0%,100% { box-shadow:0 0 0 0 rgba(93,92,222,0.4); }
            50% { box-shadow:0 0 0 12px rgba(93,92,222,0); }
        }

        .login-title-entrance {
            animation: titleSlide 0.5s ease-out 0.2s both;
        }
        .login-subtitle-entrance {
            animation: titleSlide 0.5s ease-out 0.3s both;
        }
        @keyframes titleSlide {
            0% { opacity:0; transform:translateY(10px); }
            100% { opacity:1; transform:translateY(0); }
        }

        .login-btn-stagger {
            animation: btnSlideUp 0.45s ease-out both;
        }
        @keyframes btnSlideUp {
            0% { opacity:0; transform:translateY(20px); }
            100% { opacity:1; transform:translateY(0); }
        }

        .login-error-banner {
            background-color: #FEF2F2; border-color: #FECACA; color: #991B1B;
            animation: shakeError 0.5s ease-out;
        }
        .dark .login-error-banner {
            background-color: rgba(127,29,29,0.3); border-color: rgba(252,165,165,0.3); color: #FCA5A5;
        }
        @keyframes shakeError {
            0%,100% { transform:translateX(0); }
            15% { transform:translateX(-8px); }
            30% { transform:translateX(6px); }
            45% { transform:translateX(-4px); }
            60% { transform:translateX(2px); }
        }

        .login-success-overlay {
            animation: successPop 0.6s cubic-bezier(0.34,1.56,0.64,1);
        }
        @keyframes successPop {
            0% { opacity:0; transform:scale(0.5); }
            100% { opacity:1; transform:scale(1); }
        }

        /* Login button disabled/loading state */
        .login-btn-loading {
            opacity: 0.7; pointer-events: none; cursor: wait;
        }

        /* Inline search inside header */
        .search-inline-container {
            flex: 1;
            display: flex;
            align-items: center;
            min-width: 0;
            opacity: 0;
            transform: scaleX(0.85);
            transform-origin: right center;
            transition: opacity 0.25s ease, transform 0.25s ease;
        }
        .search-inline-container.search-active {
            opacity: 1;
            transform: scaleX(1);
        }
        .search-inline-container.hidden {
            display: none !important;
        }
        .header-left-transition,
        .header-right-transition {
            transition: opacity 0.2s ease, transform 0.2s ease, width 0.2s ease;
        }
        .header-left-hidden {
            opacity: 0;
            transform: translateX(-20px);
            width: 0 !important;
            overflow: hidden;
            pointer-events: none;
            flex: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            min-width: 0 !important;
        }
        .header-right-hidden {
            opacity: 0;
            width: 0 !important;
            overflow: hidden;
            pointer-events: none;
            flex: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            min-width: 0 !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 card-bg flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <div class="space-y-2">
                <h2 class="text-2xl font-bold gradient-text">Kuia+ Shop</h2>
                <p id="loadingStatus" class="text-gray-600 dark:text-gray-400 loading-dots">Carregando</p>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-40 hidden">
        <!-- Part√≠culas decorativas animadas -->
        <div class="login-particles" aria-hidden="true">
            <div class="particle particle-1"></div>
            <div class="particle particle-2"></div>
            <div class="particle particle-3"></div>
            <div class="particle particle-4"></div>
            <div class="particle particle-5"></div>
            <div class="particle particle-6"></div>
        </div>
        <div class="card-bg p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4 border login-card-entrance glass" style="background-color:white;">
            <div class="text-center mb-8">
                <div class="w-20 h-20 gradient-bg rounded-full flex items-center justify-center mx-auto mb-4 login-logo-pulse">
                    <span class="text-white font-bold text-3xl">K+</span>
                </div>
                <h1 class="text-3xl font-bold gradient-text mb-2 login-title-entrance">Kuia+ Shop</h1>
                <p class="text-gray-600 dark:text-gray-400 login-subtitle-entrance">Bem-vindo √† nossa loja</p>
                <p class="text-sm text-gray-500 dark:text-gray-500 mt-2 login-subtitle-entrance" style="animation-delay:0.15s">Escolha como deseja continuar</p>
            </div>

            <!-- √Årea de erro inline para login -->
            <div id="loginErrorBanner" class="hidden mb-4 p-4 rounded-xl border flex items-start space-x-3 login-error-banner">
                <span class="text-xl flex-shrink-0">‚ö†Ô∏è</span>
                <div class="flex-1 min-w-0">
                    <p id="loginErrorText" class="text-sm font-medium"></p>
                    <p id="loginErrorHint" class="text-xs mt-1 opacity-80"></p>
                </div>
                <button onclick="hideLoginError()" class="text-lg flex-shrink-0 opacity-60 hover:opacity-100 transition-opacity">√ó</button>
            </div>

            <!-- Login Options -->
            <div class="space-y-4" id="loginOptions">
                <button id="guestBtn" class="w-full btn-secondary py-4 px-6 rounded-xl hover-lift ripple flex items-center justify-center space-x-3 login-btn-stagger" style="animation-delay:0.1s">
                    <span class="text-2xl">üë§</span>
                    <span class="font-medium">Continuar como Visitante</span>
                </button>

                <button id="googleLoginBtn" class="w-full card-bg border py-4 px-6 rounded-xl hover-lift ripple flex items-center justify-center space-x-3 login-btn-stagger" style="animation-delay:0.2s">
                    <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span class="font-medium" id="googleBtnText">Continuar com Google</span>
                    <span id="googleBtnLoader" class="hidden flex items-center">
                        <div class="animate-spin rounded-full h-5 w-5 border-2 border-gray-600 border-t-transparent"></div>
                    </span>
                </button>

                <button id="showEmailLoginBtn" class="w-full btn-primary text-white py-4 px-6 rounded-xl hover-lift ripple flex items-center justify-center space-x-3 login-btn-stagger" style="animation-delay:0.3s">
                    <span class="text-2xl">üìß</span>
                    <span class="font-medium">Entrar com Email</span>
                </button>
            </div>

            <!-- Email Login Form -->
            <div id="emailLoginForm" class="hidden space-y-6 animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">Login</h3>
                    <button id="backToOptionsBtn" class="text-gray-500 hover:text-primary transition-colors font-medium">
                        ‚Üê Voltar
                    </button>
                </div>

                <form id="loginForm" class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="Email" required
                           class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                    <input type="password" id="loginPassword" placeholder="Senha" required
                           class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                    <button type="submit" class="w-full btn-primary text-white py-4 rounded-xl hover-lift ripple font-medium">
                        Entrar
                    </button>
                </form>

                <div class="text-center space-y-2">
                    <div>
                        <button id="showForgotPasswordBtn" class="text-sm text-primary hover:underline font-medium">Esqueceu a senha?</button>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500 dark:text-gray-400">N√£o tem conta? </span>
                        <button id="showRegisterBtn" class="text-sm text-primary hover:underline font-medium">Criar conta</button>
                    </div>
                </div>
            </div>

            <!-- Forgot Password Form -->
            <div id="forgotPasswordForm" class="hidden space-y-6 animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">Recuperar Senha</h3>
                    <button id="backToLoginFromForgotBtn" class="text-gray-500 hover:text-primary transition-colors font-medium">
                        ‚Üê Voltar
                    </button>
                </div>

                <div class="text-center mb-4">
                    <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-3xl">üîë</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Digite seu email e enviaremos um link para redefinir sua senha.</p>
                </div>

                <form id="forgotPasswordFormEl" class="space-y-4">
                    <input type="email" id="forgotEmail" placeholder="Seu email cadastrado" required
                           class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                    <button type="submit" id="forgotPasswordSubmitBtn" class="w-full btn-primary text-white py-4 rounded-xl hover-lift ripple font-medium">
                        <span id="forgotBtnText">Enviar Link de Recupera√ß√£o</span>
                        <span id="forgotBtnLoader" class="hidden flex items-center justify-center">
                            <div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div>
                            Enviando...
                        </span>
                    </button>
                </form>

                <div id="forgotPasswordSuccess" class="hidden text-center p-4 rounded-xl bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700">
                    <span class="text-3xl block mb-2">‚úÖ</span>
                    <p class="text-sm font-medium text-green-800 dark:text-green-200">Email de recupera√ß√£o enviado!</p>
                    <p class="text-xs text-green-600 dark:text-green-400 mt-1">Verifique sua caixa de entrada e pasta de spam.</p>
                </div>
            </div>

            <!-- Email Register Form -->
            <div id="emailRegisterForm" class="hidden space-y-6 animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">Criar Conta</h3>
                    <button id="backToLoginBtn" class="text-gray-500 hover:text-primary transition-colors font-medium">
                        ‚Üê Voltar
                    </button>
                </div>

                <form id="registerForm" class="space-y-4">
                    <div class="text-center">
                        <div class="relative inline-block">
                            <img id="previewAvatar" src="https://via.placeholder.com/80?text=üì∑" alt="Preview" 
                                 class="w-20 h-20 rounded-full object-cover border-4 border-gray-300 dark:border-gray-600 hover-lift">
                            <label for="profilePicture" class="absolute -bottom-1 -right-1 btn-primary text-white rounded-full p-2 cursor-pointer hover-lift">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </label>
                            <input type="file" id="profilePicture" accept="image/*" class="hidden">
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">Clique para adicionar foto</p>
                    </div>

                    <input type="text" id="registerName" placeholder="Nome completo" required
                           class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                    <input type="email" id="registerEmail" placeholder="Email" required
                           class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                    <input type="password" id="registerPassword" placeholder="Senha (m√≠n. 6 caracteres)" required minlength="6"
                           class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                    
                    <button type="submit" id="registerSubmitBtn" class="w-full btn-primary text-white py-4 rounded-xl hover-lift ripple font-medium">
                        <span id="registerBtnText">Criar Conta</span>
                        <span id="registerBtnLoader" class="hidden flex items-center justify-center">
                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                            Criando conta...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden pb-20 min-h-screen">
        <!-- Notifications Area -->
        <div id="notificationArea" class="fixed top-4 right-4 z-50 space-y-3 max-w-sm pointer-events-none">
            <!-- Notifications will be added here -->
        </div>

        <!-- Header -->
        <header id="mainHeader" class="shadow-lg border-b sticky top-0 z-30 header-purple">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16 header-row">
                    <!-- Logo + Nav (hidden when search is open) -->
                    <div id="headerLeft" class="flex items-center space-x-4 min-w-0 header-left-transition">
                        <div class="flex items-center space-x-3 flex-shrink-0">
                            <img src="chop.png"
     alt="Logo da Loja"
     style="height: 58px;
       width: auto;
       border-radius: 6px;
       background-color: transparent;
       margin-left: -10px;
       display: inline-block;">
                        </div>

                    </div>

                    <!-- Inline Search Bar (expands inside header, replaces logo+nav) -->
                    <div id="searchContainer" class="search-inline-container hidden">
                        <div class="flex items-center w-full gap-2">
                            <button id="searchCloseBtn" class="flex-shrink-0 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" title="Fechar pesquisa">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                            </button>
                            <div class="relative flex-1">
                                <input type="text"
                                    id="searchInput"
                                    placeholder="Buscar produtos..."
                                    class="w-full px-4 py-2.5 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary pr-10"
                                >
                                <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Right side actions -->
                    <div id="headerRight" class="flex items-center space-x-3 flex-shrink-0 header-right-transition">
                        <!-- Search Button -->
                        <div id="searchWrapper" class="relative flex items-center">
                            <button id="searchToggleBtn" class="p-3 btn-secondary rounded-xl hover-lift" title="Pesquisar">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- Toggle Filters Button -->
                        <button id="headerFilterToggleBtn" class="p-3 btn-secondary rounded-xl hover-lift" title="Mostrar/Ocultar Filtros">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                            </svg>
                        </button>

                        <!-- User Menu -->
                        <div class="relative">
                            <button id="userMenuBtn" class="flex items-center space-x-3 p-2 btn-secondary rounded-xl hover-lift">
                                <img id="userAvatar" src="https://via.placeholder.com/32?text=üë§" alt="Avatar" class="w-8 h-8 rounded-full border-2 border-primary">
                                <span id="userName" class="hidden sm:block text-sm font-medium">Visitante</span>
                            </button>
                            <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 card-bg rounded-xl shadow-lg border z-50 animate-scale-in">
                                <div id="userMenuContent">
                                    <!-- Content will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Home Section -->
            <div id="homeSection" class="space-y-8">
                <div>
                   
                    <!-- Filter Controls (hidden by default, toggled from header) -->
                    <div id="filterControlsWrapper" class="filter-container collapsed">
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                        <div class="flex items-center gap-3">
                            <button id="toggleCategoryFilters" class="btn-primary text-white px-6 py-3 rounded-xl hover-lift ripple flex items-center space-x-2">
                                <span class="font-medium">Categorias</span>
                                <span id="categoryToggleIcon" class="transform transition-transform">‚ñº</span>
                            </button>

                            <button id="togglePriceFilters" class="btn-secondary px-6 py-3 rounded-xl hover-lift ripple flex items-center space-x-2">
                                <span class="font-medium">Pre√ßos</span>
                                <span id="priceToggleIcon" class="transform transition-transform">‚ñº</span>
                            </button>
                        </div>

                        <div class="text-sm text-gray-600 dark:text-gray-400 font-medium">
                            <span id="productsCount">0 produtos encontrados</span>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="space-y-4 mb-8">
                        <!-- Category Filters -->
                        <div id="categoryFiltersContainer" class="filter-container">
                            <div class="card-bg rounded-2xl p-6 border shadow-sm">
                                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                                    Filtrar por Categoria
                                </h3>
                                <div class="flex flex-wrap gap-3" id="categoryFilters">
                                    <button class="category-filter-btn btn-primary text-white px-4 py-2 rounded-full text-sm font-medium hover-lift" data-category="all">
                                        Todos
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Price Filters -->
                        <div id="priceFiltersContainer" class="filter-container">
                            <div class="card-bg rounded-2xl p-6 border shadow-sm">
                                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                                    Filtrar por Pre√ßo
                                </h3>
                                <div class="flex flex-wrap gap-3">
                                    <button class="price-filter-btn btn-primary text-white px-4 py-2 rounded-full text-sm font-medium hover-lift" data-price="all">
                                        Todos os pre√ßos
                                    </button>
                                    <button class="price-filter-btn btn-secondary px-4 py-2 rounded-full text-sm font-medium hover-lift" data-price="0-1000">
                                        At√© 1.000 Kz
                                    </button>
                                    <button class="price-filter-btn btn-secondary px-4 py-2 rounded-full text-sm font-medium hover-lift" data-price="1000-5000">
                                        1.000 - 5.000 Kz
                                    </button>
                                    <button class="price-filter-btn btn-secondary px-4 py-2 rounded-full text-sm font-medium hover-lift" data-price="5000-10000">
                                        5.000 - 10.000 Kz
                                    </button>
                                    <button class="price-filter-btn btn-secondary px-4 py-2 rounded-full text-sm font-medium hover-lift" data-price="10000+">
                                        Acima de 10.000 Kz
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div id="productsGrid" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3">
                    <div class="col-span-full text-center py-20">
                        <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Carregando produtos...</p>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesSection" class="hidden space-y-8">
                <h2 class="text-4xl font-bold gradient-text">Categorias</h2>
                <div id="categoriesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <div class="col-span-full text-center py-20">
                        <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Carregando categorias...</p>
                    </div>
                </div>
            </div>

            <!-- Favorites Section -->
            <div id="favoritesSection" class="hidden space-y-8">
                <h2 class="text-4xl font-bold gradient-text">Meus Favoritos</h2>
                <div id="favoritesGrid" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3">
                    <div class="col-span-full text-center py-20">
                        <div class="text-6xl mb-6 animate-float">‚ù§Ô∏è</div>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Carregando favoritos...</p>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="ordersSection" class="hidden space-y-8">
                <h2 class="text-4xl font-bold gradient-text">Meus Pedidos</h2>
                <div id="ordersGrid" class="space-y-6">
                    <div class="text-center py-20">
                        <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Carregando pedidos...</p>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div id="chatFullSection" class="hidden space-y-8">
                <div class="card-bg rounded-2xl shadow-lg border h-96 flex flex-col">
                    <div class="flex items-center justify-between p-6 border-b">
                        <div id="chatFullHeader" class="flex items-center space-x-3">
                            <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                                <span class="text-white text-xl">üí¨</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 dark:text-gray-200">Suporte ao Cliente</h4>
                                <div id="chatFullStatus">
                                    <span class="inline-flex items-center px-3 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400">
                                        <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                                        Chat offline
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div id="adminOnlineFullStatus" class="hidden">
                            <span class="inline-flex items-center px-3 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                                Admin online
                            </span>
                        </div>
                    </div>
                    
                    <div id="chatFullContainer" class="flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900">
                        <div id="chatFullMessages" class="space-y-4">
                            <div class="text-center text-gray-500 dark:text-gray-400">
                                <div class="card-bg rounded-2xl p-6 border inline-block">
                                    <p class="mb-2 text-lg">üí¨ Chat de Suporte</p>
                                    <p class="text-sm">O administrador ir√° iniciar o chat quando necess√°rio</p>
                                    <div class="mt-4 flex items-center justify-center">
                                        <span class="w-3 h-3 bg-gray-400 rounded-full mr-2 animate-pulse"></span>
                                        <span class="text-sm">Aguardando...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="chatFullInputContainer" class="p-6 border-t hidden">
                        <div class="flex space-x-3 mb-3">
                           <input 
  type="text" 
  id="chatFullInput" 
  placeholder="Digite sua mensagem..." 
  class="flex-1 px-4 py-3 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary" 
  style="width:60%;"
>
                            <input type="file" id="chatFullImageInput" accept="image/*" class="hidden">
                            <button id="chatFullImageBtn" class="btn-secondary px-4 py-3 rounded-xl hover-lift">
                                üì∑
                            </button>
                            <button id="sendChatFullBtn" class="btn-primary text-white px-6 py-3 rounded-xl hover-lift">
                                üì§
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Pressione Enter para enviar ‚Ä¢ Clique em üì∑ para enviar imagem</p>
                    </div>
                </div>
            </div>

            <!-- Notifications Section -->
            <div id="notificationsSection" class="hidden space-y-8">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <h2 class="text-4xl font-bold gradient-text">Notifica√ß√µes</h2>
                    <div class="flex space-x-3">
                        <button id="markAllAsReadBtn" class="btn-secondary px-6 py-3 rounded-xl hover-lift hidden">
                            ‚úì Marcar Todas como Lidas
                        </button>
                        <button id="deleteAllNotificationsBtn" class="bg-red-500 text-white px-6 py-3 rounded-xl hover-lift hidden">
                            üóëÔ∏è Excluir Todas
                        </button>
                    </div>
                </div>
                <div id="notificationsList" class="space-y-4">
                    <div class="text-center py-20">
                        <div class="text-6xl mb-6 animate-float">üîî</div>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Carregando notifica√ß√µes...</p>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="hidden space-y-8">
                <h2 class="text-4xl font-bold gradient-text">Meu Perfil</h2>
                <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Profile Info -->
                    <div class="card-bg rounded-2xl shadow-lg border p-8">
                        <div class="flex items-center space-x-6 mb-8">
                            <div class="relative">
                                <img id="profileAvatar" src="" alt="Avatar" class="w-20 h-20 rounded-full cursor-pointer hover-lift border-4 border-primary" onclick="openProfilePictureModal()">
                                <button onclick="openProfilePictureModal()" class="absolute -bottom-2 -right-2 btn-primary text-white rounded-full p-2 hover-lift">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                </button>
                            </div>
                            <div>
                                <h3 id="profileName" class="text-2xl font-bold text-gray-800 dark:text-gray-200"></h3>
                                <p id="profileEmail" class="text-gray-600 dark:text-gray-400"></p>
                                <div id="chatStatus" class="mt-3">
                                    <span class="inline-flex items-center px-3 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400">
                                        <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                                        Chat offline
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <h4 class="text-xl font-bold text-gray-800 dark:text-gray-200">Meus Pedidos</h4>
                            <div id="userOrders" class="space-y-4">
                                <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                                    <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                                    Carregando pedidos...
                                </div>
                            </div>
                            <button id="viewAllOrdersBtn" class="w-full btn-primary text-white py-4 rounded-xl hover-lift ripple font-medium">
                                üì¶ Ver Todos os Pedidos
                            </button>
                        </div>
                    </div>

                    <!-- Chat Section (Hidden for now) -->
                    <div style="display:none;" class="card-bg rounded-2xl shadow-lg border flex flex-col h-96">
                        <!-- Chat content here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation Footer - Estilo Loja Online -->
        <footer class="fixed bottom-0 left-0 right-0 z-30 shop-footer">
            <div class="shop-footer-safe">
                <div class="grid grid-cols-6 footer-grid-responsive" style="height:60px;">
                    <!-- In√≠cio -->
                    <button id="footerHomeBtn" class="footer-nav-btn footer-nav-item active">
                        <span class="footer-icon-wrap">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                            </svg>
                        </span>
                        <span class="footer-label">In√≠cio</span>
                        <span class="footer-active-bar"></span>
                    </button>
                    <!-- Categorias -->
                    <button id="footerCategoriesBtn" class="footer-nav-btn footer-nav-item">
                        <span class="footer-icon-wrap">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25a2.25 2.25 0 0 1-2.25-2.25v-2.25Z" />
                            </svg>
                        </span>
                        <span class="footer-label">Categorias</span>
                        <span class="footer-active-bar"></span>
                    </button>
                    <!-- Favoritos -->
                    <button id="footerFavoritesBtn" class="footer-nav-btn footer-nav-item">
                        <span class="footer-icon-wrap">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                            </svg>
                        </span>
                        <span class="footer-label">Favoritos</span>
                        <span class="footer-active-bar"></span>
                    </button>
                    <!-- Pedidos -->
                    <button id="footerOrdersBtn" class="footer-nav-btn footer-nav-item">
                        <span class="footer-icon-wrap">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                            </svg>
                        </span>
                        <span class="footer-label">Pedidos</span>
                        <span class="footer-active-bar"></span>
                    </button>
                    <!-- Chat -->
                    <button id="footerChatBtn" class="footer-nav-btn footer-nav-item">
                        <span class="footer-icon-wrap">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
                            </svg>
                            <span id="footerChatNotification" class="footer-chat-dot hidden"></span>
                        </span>
                        <span class="footer-label">Chat</span>
                        <span class="footer-active-bar"></span>
                    </button>
                    <!-- Carrinho -->
                    <button id="footerCartBtn" class="footer-nav-btn footer-nav-item">
                        <span class="footer-icon-wrap">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                            </svg>
                            <span id="footerCartCount" class="footer-cart-badge hidden">0</span>
                        </span>
                        <span class="footer-label">Carrinho</span>
                        <span class="footer-active-bar"></span>
                    </button>
                </div>
            </div>
        </footer>
    </div>

    <!-- Profile Picture Full-Screen Overlay -->
    <div id="profilePictureModal" class="fixed inset-0 z-50 hidden" style="transition: opacity 0.3s ease, transform 0.3s ease;">
        <div class="absolute inset-0 bg-white dark:bg-gray-900 flex flex-col" style="transition: background-color 0.3s ease;">
            <!-- Overlay Header -->
            <header class="relative flex items-center px-4 sm:px-6 h-14 border-b border-gray-200 dark:border-gray-700 flex-shrink-0" style="background:inherit;">
                <!-- Left: Back button -->
                <button id="closeProfilePictureBtn" class="relative z-10 flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span class="text-sm font-medium hidden sm:inline">Voltar</span>
                </button>
                <!-- Center: Title -->
                <h3 class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-base font-bold gradient-text truncate max-w-[55%] text-center pointer-events-none">Alterar Foto do Perfil</h3>
                <!-- Right: spacer -->
                <div class="relative z-10 ml-auto flex-shrink-0 w-9"></div>
            </header>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto">
                <div class="max-w-3xl mx-auto px-4 sm:px-6 py-10">
                    <div class="text-center">
                        <div class="relative inline-block mb-6">
                            <img id="profilePicturePreview" src="" alt="Preview" class="w-36 h-36 rounded-full object-cover border-4 border-primary shadow-lg">
                            <label for="newProfilePicture" class="absolute bottom-0 right-0 btn-primary text-white rounded-full p-3 cursor-pointer hover-lift shadow-lg">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </label>
                            <input type="file" id="newProfilePicture" accept="image/*" class="hidden">
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-8">Clique no √≠cone da c√¢mera para escolher uma nova foto</p>
                    </div>
                </div>
            </div>

            <!-- Sticky Bottom Actions -->
            <div class="flex-shrink-0 border-t border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-3" style="background:inherit;">
                <div class="max-w-3xl mx-auto flex items-center gap-3">
                    <button id="cancelProfilePictureBtn" class="flex-1 btn-secondary py-3.5 rounded-xl hover-lift font-semibold text-base">
                        Cancelar
                    </button>
                    <button id="saveProfilePictureBtn" class="flex-1 btn-primary text-white py-3.5 rounded-xl hover-lift ripple font-semibold text-base" disabled>
                        <span id="saveProfilePictureText">Salvar</span>
                        <span id="saveProfilePictureLoader" class="hidden flex items-center justify-center">
                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                            Salvando...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Full Screen Overlay -->
    <div id="chatOverlay" class="fixed inset-0 z-50 hidden" style="transition: opacity 0.3s ease, transform 0.3s ease;">
        <div class="absolute inset-0 bg-white dark:bg-gray-900 flex flex-col" style="transition: background-color 0.3s ease;">
            <!-- Overlay Header -->
            <header class="relative flex items-center px-4 sm:px-6 h-14 border-b border-gray-200 dark:border-gray-700 flex-shrink-0" style="background:inherit;">
                <!-- Left: Back button -->
                <button id="closeChatOverlayBtn" class="relative z-10 flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span class="text-sm font-medium hidden sm:inline">Voltar</span>
                </button>
                <!-- Center: Title -->
                <h3 class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-base font-bold gradient-text truncate max-w-[55%] text-center pointer-events-none">Suporte ao Cliente</h3>
                <!-- Right: Status -->
                <div id="chatOverlayStatus" class="relative z-10 ml-auto flex-shrink-0">
                    <span class="inline-flex items-center px-3 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400">
                        <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                        Chat offline
                    </span>
                </div>
            </header>

            <!-- Scrollable Chat Content -->
            <div id="chatOverlayContainer" class="flex-1 overflow-y-auto p-4 sm:p-6 bg-gray-50 dark:bg-gray-900">
                <div id="chatOverlayMessages" class="space-y-4 max-w-3xl mx-auto">
                    <div class="text-center text-gray-500 dark:text-gray-400">
                        <div class="card-bg rounded-2xl p-6 border inline-block animate-fade-in">
                            <p class="mb-2 text-lg">üí¨ Chat de Suporte</p>
                            <p class="text-sm">O administrador ir√° iniciar o chat quando necess√°rio</p>
                            <div class="mt-4 flex items-center justify-center">
                                <span class="w-3 h-3 bg-gray-400 rounded-full mr-2 animate-pulse"></span>
                                <span class="text-sm">Aguardando...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sticky Bottom Input -->
            <div id="chatOverlayInputContainer" class="flex-shrink-0 border-t border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-3 hidden" style="background:inherit;">
                <div class="max-w-3xl mx-auto">
                    <div class="flex items-center gap-3 mb-2">
                        <input type="file" id="chatOverlayImageInput" accept="image/*" class="hidden">
                        <button id="chatOverlayImageBtn" class="btn-secondary flex-shrink-0 w-11 h-11 flex items-center justify-center rounded-xl hover-lift" aria-label="Enviar imagem">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h2l2-3h10l2 3h2a1 1 0 011 1v11a1 1 0 01-1 1H3a1 1 0 01-1-1V8a1 1 0 011-1zm9 3a3 3 0 100 6 3 3 0 000-6z"/></svg>
                        </button>
                        <input type="text" id="chatOverlayInput" placeholder="Digite sua mensagem..."
                               class="flex-1 min-w-0 px-4 py-3 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary">
                        <button id="sendChatOverlayBtn" class="btn-primary flex-shrink-0 text-white w-11 h-11 flex items-center justify-center rounded-xl hover-lift" aria-label="Enviar mensagem">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12L3 2l18 10L3 22l3-10zm0 0h8"/></svg>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Pressione Enter para enviar ‚Ä¢ Clique em üì∑ para enviar imagem</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cartSidebar" class="fixed inset-y-0 right-0 w-80 card-bg shadow-2xl transform translate-x-full transition-transform z-50 border-l">
        <div class="flex flex-col h-full">
            <div class="flex items-center justify-between p-6 border-b gradient-bg">
                <h3 class="text-xl font-bold text-white">Carrinho de Compras</h3>
                <button id="closeCartBtn" class="text-white hover:text-gray-200 text-2xl hover-lift">
                    ‚ùå
                </button>
            </div>
            
            <div id="cartItems" class="flex-1 overflow-y-auto p-6">
                <div class="text-center py-20">
                    <div class="text-6xl mb-6 animate-float">üõí</div>
                    <p class="text-gray-500 dark:text-gray-400 text-lg">Seu carrinho est√° vazio</p>
                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">Adicione produtos para come√ßar</p>
                </div>
            </div>
            
            <div class="border-t p-6">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-xl font-bold text-gray-800 dark:text-gray-200">Total:</span>
                    <span id="cartTotal" class="text-xl font-bold gradient-text">0 Kz</span>
                </div>
                <button id="checkoutBtn" class="w-full btn-primary text-white py-4 rounded-xl hover-lift ripple disabled:opacity-50 disabled:cursor-not-allowed font-medium" disabled>
                    üõí Finalizar Compra
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Overlay -->
    <div id="cartOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- Checkout Full-Screen Overlay -->
    <div id="checkoutModal" class="fixed inset-0 z-50 hidden" style="transition: opacity 0.3s ease, transform 0.3s ease;">
        <div class="absolute inset-0 bg-white dark:bg-gray-900 flex flex-col" style="transition: background-color 0.3s ease;">
            <!-- Overlay Header -->
            <header class="relative flex items-center px-4 sm:px-6 h-14 border-b border-gray-200 dark:border-gray-700 flex-shrink-0" style="background:inherit;">
                <!-- Left: Back button -->
                <button id="closeCheckoutBtn" class="relative z-10 flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span class="text-sm font-medium hidden sm:inline">Voltar</span>
                </button>
                <!-- Center: Title -->
                <h3 class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-base font-bold gradient-text truncate max-w-[55%] text-center pointer-events-none">Finalizar Compra</h3>
                <!-- Right: spacer -->
                <div class="relative z-10 ml-auto flex-shrink-0 w-9"></div>
            </header>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto">
                <div class="max-w-3xl mx-auto px-4 sm:px-6 py-6">
                    <!-- Login Required Message -->
                    <div id="loginRequiredMessage" class="hidden bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-xl p-6 mb-6">
                        <div class="flex items-center">
                            <span class="text-yellow-600 dark:text-yellow-400 text-2xl mr-4">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-yellow-800 dark:text-yellow-200">Login Necess√°rio</h4>
                                <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">Para finalizar a compra, voc√™ precisa estar logado.</p>
                            </div>
                        </div>
                        <div class="mt-6 flex space-x-3">
                            <button id="checkoutLoginBtn" class="btn-primary text-white px-4 py-2 rounded-xl hover-lift text-sm">
                                Fazer Login
                            </button>
                            <button id="checkoutRegisterBtn" class="btn-secondary px-4 py-2 rounded-xl hover-lift text-sm">
                                Criar Conta
                            </button>
                        </div>
                    </div>

                    <form id="checkoutForm" class="space-y-5">
                        <input type="text" id="customerName" required placeholder="Nome Completo *"
                               class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary">

                        <input type="tel" id="customerPhone" required placeholder="+244 xxx xxx xxx *"
                               class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary">

                        <textarea id="customerLocation" required rows="3" placeholder="Localiza√ß√£o Exata *"
                                  class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary"></textarea>

                        <textarea id="customerMessage" rows="2" placeholder="Mensagem Opcional"
                                  class="w-full px-4 py-4 text-base card-bg border rounded-xl focus:ring-2 focus:ring-primary"></textarea>

                        <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-xl">
                            <h4 class="font-bold text-gray-800 dark:text-gray-200 mb-4">Resumo do Pedido</h4>
                            <div id="checkoutSummary" class="space-y-2 mb-4"></div>
                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-gray-800 dark:text-gray-200">Total:</span>
                                    <span id="checkoutTotal" class="font-bold gradient-text text-xl"></span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sticky Bottom Actions -->
            <div class="flex-shrink-0 border-t border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-3" style="background:inherit;">
                <div class="max-w-3xl mx-auto flex items-center gap-3">
                    <button type="button" id="cancelCheckoutBtn" class="flex-1 btn-secondary py-3.5 rounded-xl hover-lift font-semibold text-base">
                        Cancelar
                    </button>
                    <button type="submit" form="checkoutForm" class="flex-1 btn-primary text-white py-3.5 rounded-xl hover-lift ripple font-semibold text-base">
                        Confirmar Pedido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Detail Full-Screen Overlay -->
    <div id="productDetailModal" class="fixed inset-0 z-50 hidden" style="transition: opacity 0.3s ease, transform 0.3s ease;">
        <div class="absolute inset-0 bg-white dark:bg-gray-900 flex flex-col" style="transition: background-color 0.3s ease;">
            <!-- Overlay Header -->
            <header class="relative flex items-center px-4 sm:px-6 h-14 border-b border-gray-200 dark:border-gray-700 flex-shrink-0" style="background:inherit;">
                <!-- Left: Back button -->
                <button id="closeDetailModalBtn" class="relative z-10 flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span class="text-sm font-medium hidden sm:inline">Voltar</span>
                </button>
                <!-- Center: Title (absolutely centered) -->
                <h3 id="detailModalTitle" class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-base font-bold gradient-text truncate max-w-[55%] text-center pointer-events-none">Detalhes do Produto</h3>
                <!-- Right: Favorite button -->
                <button id="detailFavoriteBtn" class="relative z-10 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors flex-shrink-0 ml-auto">
                    <span id="detailFavoriteIcon" class="text-xl leading-none">ü§ç</span>
                </button>
            </header>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto">
                <div class="max-w-3xl mx-auto px-4 sm:px-6 py-6">
                    <!-- Product Image -->
                    <div id="detailImage" class="w-full aspect-square max-h-[420px] bg-gray-100 dark:bg-gray-800 rounded-2xl flex items-center justify-center overflow-hidden mb-6">
                        <div class="text-6xl text-gray-400">üñºÔ∏è</div>
                    </div>

                    <!-- Product Info -->
                    <div class="space-y-5">
                        <div>
                            <p id="detailCategory" class="text-primary font-semibold capitalize text-sm tracking-wide mb-1"></p>
                            <h4 id="detailName" class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 leading-tight"></h4>
                        </div>

                        <div id="detailPriceContainer" class="flex flex-wrap items-center gap-3">
                            <span id="detailPrice" class="text-3xl sm:text-4xl font-extrabold gradient-text"></span>
                            <span id="detailOldPrice" class="text-lg text-gray-400 line-through hidden"></span>
                            <span id="detailDiscount" class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold hidden"></span>
                        </div>

                        <p id="detailStock" class="text-sm text-gray-600 dark:text-gray-400"></p>

                        <div id="detailDescriptionContainer" class="hidden">
                            <h5 class="font-bold text-gray-800 dark:text-gray-200 mb-2 text-lg">Descri√ß√£o</h5>
                            <p id="detailDescription" class="text-gray-600 dark:text-gray-400 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sticky Bottom Actions -->
            <div class="flex-shrink-0 border-t border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-3" style="background:inherit;">
                <div class="max-w-3xl mx-auto flex items-center gap-3">
                    <button id="detailAddToCartBtn" class="flex-1 btn-primary text-white py-3.5 rounded-xl hover-lift ripple disabled:opacity-50 font-semibold text-base">
                        <span class="mr-2">üõí</span>Adicionar ao Carrinho
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        /* eslint-disable no-restricted-globals */
        console.log('üöÄ Iniciando Kuia+ Shop...');
        document.getElementById('loadingStatus').textContent = 'Carregando Firebase';

        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';
        import { getDatabase, ref, onValue, push, set, remove, update } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js';

        console.log('‚úÖ Firebase modules loaded');
        document.getElementById('loadingStatus').textContent = 'Conectando ao Firebase';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyArmhNnjraGaY017AP5uRcM8w0WWditrIs",
            authDomain: "kuia-shop.firebaseapp.com",
            projectId: "kuia-shop",
            storageBucket: "kuia-shop.appspot.com",
            messagingSenderId: "53786495493",
            appId: "1:53786495493:web:85fa67bd5de1d351b1ea6c",
            measurementId: "G-LTZ8VLN3LN"
        };

        // Initialize Firebase
        let app, auth, database, firestore;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            database = getDatabase(app);
            firestore = getFirestore(app);
            console.log('‚úÖ Firebase initialized successfully');
            document.getElementById('loadingStatus').textContent = 'Chegou a hora das compras!';
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            document.getElementById('loadingStatus').textContent = 'Erro na conex√£o. Usando modo offline';
        }

        // Enhanced Dark mode setup with proper theme switching
        function initializeTheme() {
            const savedTheme = localStorage.getItem('kuia-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
            
            updateTheme(isDark);
        }

        function updateTheme(isDark) {
            const html = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');

            if (isDark) {
                html.classList.add('dark');
                if (themeToggle) themeToggle.classList.add('dark');
                if (themeIcon) {
                    themeIcon.textContent = '‚òÄÔ∏è';
                    themeIcon.style.left = '24px';
                }
            } else {
                html.classList.remove('dark');
                if (themeToggle) themeToggle.classList.remove('dark');
                if (themeIcon) {
                    themeIcon.textContent = 'üåô';
                    themeIcon.style.left = '3px';
                }
            }

            localStorage.setItem('kuia-theme', isDark ? 'dark' : 'light');
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            updateTheme(!isDark);

            // Add visual feedback
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    themeToggle.style.transform = 'scale(1)';
                }, 150);
            }
        }

        // Initialize theme
        initializeTheme();

        // Global variables
        let currentUser = null;
        let isGuest = false;
        let cart = JSON.parse(localStorage.getItem('guestCart') || '[]');
        let products = {};
        let categories = [];
        let favorites = [];
        let orders = {};
        let notifications = [];
        let currentSection = 'home';
        let currentPriceFilter = 'all';
        let currentChatId = null;
        let chatMessages = [];
        let isFullChatMode = false;
        let uploadedPhotoURL = null;

        // API Key for image upload
        const apiKeyImgBB = 'e073e02267a1f0259cd69c562e780659';

        // DOM elements
        const loadingScreen = document.getElementById('loadingScreen');
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');

        // Filter toggle elements
        const toggleCategoryFilters = document.getElementById('toggleCategoryFilters');
        const togglePriceFilters = document.getElementById('togglePriceFilters');
        const categoryFiltersContainer = document.getElementById('categoryFiltersContainer');
        const priceFiltersContainer = document.getElementById('priceFiltersContainer');
        const categoryToggleIcon = document.getElementById('categoryToggleIcon');
        const priceToggleIcon = document.getElementById('priceToggleIcon');

        // Header filter toggle (show/hide the entire filter controls area)
        const headerFilterToggleBtn = document.getElementById('headerFilterToggleBtn');
        const filterControlsWrapper = document.getElementById('filterControlsWrapper');

        function setupHeaderFilterToggle() {
            headerFilterToggleBtn.addEventListener('click', () => {
                const isCollapsed = filterControlsWrapper.classList.contains('collapsed');
                if (isCollapsed) {
                    filterControlsWrapper.classList.remove('collapsed');
                    headerFilterToggleBtn.classList.add('btn-primary', 'text-white');
                    headerFilterToggleBtn.classList.remove('btn-secondary');
                } else {
                    filterControlsWrapper.classList.add('collapsed');
                    headerFilterToggleBtn.classList.remove('btn-primary', 'text-white');
                    headerFilterToggleBtn.classList.add('btn-secondary');
                }
            });
        }

        // Enhanced Filter toggle functionality
        function setupFilterToggles() {
            toggleCategoryFilters.addEventListener('click', () => {
                const isCollapsed = categoryFiltersContainer.classList.contains('collapsed');
                
                if (isCollapsed) {
                    categoryFiltersContainer.classList.remove('collapsed');
                    categoryToggleIcon.style.transform = 'rotate(180deg)';
                    categoryToggleIcon.textContent = '‚ñ≤';
                } else {
                    categoryFiltersContainer.classList.add('collapsed');
                    categoryToggleIcon.style.transform = 'rotate(0deg)';
                    categoryToggleIcon.textContent = '‚ñº';
                }
            });

            togglePriceFilters.addEventListener('click', () => {
                const isCollapsed = priceFiltersContainer.classList.contains('collapsed');
                
                if (isCollapsed) {
                    priceFiltersContainer.classList.remove('collapsed');
                    priceToggleIcon.style.transform = 'rotate(180deg)';
                    priceToggleIcon.textContent = '‚ñ≤';
                } else {
                    priceFiltersContainer.classList.add('collapsed');
                    priceToggleIcon.style.transform = 'rotate(0deg)';
                    priceToggleIcon.textContent = '‚ñº';
                }
            });
        }

        // Enhanced notification system
        function showNotificationToast(title, message, type = 'info') {
            const notificationArea = document.getElementById('notificationArea');
            const toast = document.createElement('div');
            
            const typeStyles = {
                info: 'bg-blue-500',
                success: 'bg-green-500', 
                warning: 'bg-yellow-500',
                error: 'bg-red-500'
            };
            
            const typeIcons = {
                info: '‚ÑπÔ∏è',
                success: '‚úÖ',
                warning: '‚ö†Ô∏è',
                error: '‚ùå'
            };
            
            toast.className = `notification ${typeStyles[type]} text-white p-4 rounded-xl shadow-lg animate-notification-slide pointer-events-auto max-w-sm`;
            toast.innerHTML = `
                <div class="flex items-start space-x-3">
                    <span class="text-xl flex-shrink-0">${typeIcons[type]}</span>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-sm">${title}</h4>
                        <p class="text-xs opacity-90 mt-1">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:opacity-75 text-lg flex-shrink-0 hover-lift">
                        √ó
                    </button>
                </div>
            `;
            
            notificationArea.appendChild(toast);
            
            // Auto remove
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }

        // Enhanced notification system with localStorage fallback
        function loadNotifications() {
            if (!currentUser) return;
            
            const notificationsRef = ref(database, `notifications/${currentUser.uid}`);
            onValue(notificationsRef, (snapshot) => {
                const notificationsData = snapshot.val() || {};
                let allNotifications = Object.entries(notificationsData)
                    .map(([id, notification]) => ({ id, ...notification }))
                    .filter(n => !n.deleted);

                allNotifications = applyLocalStorageFilters(allNotifications);
                notifications = allNotifications.sort((a, b) => b.timestamp - a.timestamp);
                
                updateNotificationBadge();
                renderNotifications();
            });

            const globalNotificationsRef = ref(database, 'notifications/global');
            onValue(globalNotificationsRef, (snapshot) => {
                const globalNotifications = snapshot.val() || {};
                Object.entries(globalNotifications).forEach(([id, notification]) => {
                    if (notification.timestamp > (localStorage.getItem('lastGlobalNotificationSeen') || 0)) {
                        showNotificationToast(notification.title, notification.message, notification.type);
                    }
                });
                localStorage.setItem('lastGlobalNotificationSeen', Date.now());
            });
        }

        function applyLocalStorageFilters(notificationsList) {
            const deletedNotifications = getLocalDeletedNotifications();
            const readNotifications = getLocalReadNotifications();
            
            return notificationsList.map(notification => {
                if (readNotifications.includes(notification.id)) {
                    notification.read = true;
                }
                return notification;
            }).filter(notification => {
                return !deletedNotifications.includes(notification.id);
            });
        }

        function getLocalDeletedNotifications() {
            const key = `deletedNotifications_${currentUser?.uid || 'guest'}`;
            const deleted = localStorage.getItem(key);
            return deleted ? JSON.parse(deleted) : [];
        }

        function addToLocalDeletedNotifications(notificationId) {
            const key = `deletedNotifications_${currentUser?.uid || 'guest'}`;
            const deleted = getLocalDeletedNotifications();
            if (!deleted.includes(notificationId)) {
                deleted.push(notificationId);
                localStorage.setItem(key, JSON.stringify(deleted));
            }
        }

        function getLocalReadNotifications() {
            const key = `readNotifications_${currentUser?.uid || 'guest'}`;
            const read = localStorage.getItem(key);
            return read ? JSON.parse(read) : [];
        }

        function addToLocalReadNotifications(notificationId) {
            const key = `readNotifications_${currentUser?.uid || 'guest'}`;
            const read = getLocalReadNotifications();
            if (!read.includes(notificationId)) {
                read.push(notificationId);
                localStorage.setItem(key, JSON.stringify(read));
            }
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read && !n.deleted).length;
            const badge = document.getElementById('notificationBadge');

            if (badge) {
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        function renderNotifications() {
            const hasUnreadNotifications = notifications.some(n => !n.read);
            const hasNotifications = notifications.length > 0;

            document.getElementById('markAllAsReadBtn').classList.toggle('hidden', !hasUnreadNotifications);
            document.getElementById('deleteAllNotificationsBtn').classList.toggle('hidden', !hasNotifications);

            const notificationsList = document.getElementById('notificationsList');

            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üîî</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Nenhuma notifica√ß√£o</h3>
                        <p class="text-gray-500 dark:text-gray-400">Voc√™ receber√° atualiza√ß√µes sobre seus pedidos aqui</p>
                    </div>
                `;
                return;
            }

            notificationsList.innerHTML = notifications.map(notification => {
                const isUnread = !notification.read;
                const typeStyles = {
                    info: 'bg-blue-50 dark:bg-blue-900 border-blue-200 dark:border-blue-700',
                    success: 'bg-green-50 dark:bg-green-900 border-green-200 dark:border-green-700',
                    warning: 'bg-yellow-50 dark:bg-yellow-900 border-yellow-200 dark:border-yellow-700',
                    error: 'bg-red-50 dark:bg-red-900 border-red-200 dark:border-red-700'
                };
                const typeIcons = {
                    info: '‚ÑπÔ∏è',
                    success: '‚úÖ',
                    warning: '‚ö†Ô∏è',
                    error: '‚ùå'
                };

                return `
                    <div class="card-bg border rounded-2xl p-6 ${typeStyles[notification.type] || typeStyles.info} ${isUnread ? 'ring-2 ring-primary ring-opacity-50' : ''} animate-fade-in hover-lift">
                        <div class="flex items-start space-x-4">
                            <div class="text-3xl animate-float">${typeIcons[notification.type] || typeIcons.info}</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-bold text-gray-800 dark:text-gray-200 text-lg">${notification.title}</h4>
                                    <div class="flex items-center space-x-3">
                                        ${isUnread ? '<span class="btn-primary text-white text-xs px-3 py-1 rounded-full animate-pulse">Novo</span>' : ''}
                                        <button onclick="deleteNotification('${notification.id}')" class="text-red-500 hover:text-red-700 hover-lift" title="Excluir">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-3">${notification.message}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-500 mb-3">
                                    ${new Date(notification.timestamp).toLocaleString('pt-BR')}
                                </p>
                                ${isUnread ? `
                                    <button onclick="markNotificationAsRead('${notification.id}')" class="btn-secondary px-4 py-2 rounded-xl hover-lift text-sm">
                                        Marcar como lida
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.markNotificationAsRead = async function(notificationId) {
            if (!currentUser) return;
            
            try {
                await update(ref(database, `notifications/${currentUser.uid}/${notificationId}`), {
                    read: true,
                    readAt: Date.now()
                });
                console.log('‚úÖ Notification marked as read:', notificationId);
            } catch (error) {
                console.error('‚ùå Error marking notification as read:', error);
                addToLocalReadNotifications(notificationId);
                
                const notification = notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    renderNotifications();
                    updateNotificationBadge();
                }
                
                showNotificationToast('Aviso', 'Notifica√ß√£o marcada como lida localmente', 'warning');
            }
        };

        window.deleteNotification = async function(notificationId) {
            if (!currentUser) return;
            
            showConfirmDialog('Tem certeza que deseja excluir esta notifica√ß√£o?', async () => {
                try {
                    await remove(ref(database, `notifications/${currentUser.uid}/${notificationId}`));
                    console.log('‚úÖ Notification deleted:', notificationId);
                    showNotificationToast('Sucesso', 'Notifica√ß√£o exclu√≠da', 'success');
                } catch (error) {
                    console.error('‚ùå Error deleting notification:', error);
                    
                    addToLocalDeletedNotifications(notificationId);
                    const index = notifications.findIndex(n => n.id === notificationId);
                    if (index > -1) {
                        notifications.splice(index, 1);
                        renderNotifications();
                        updateNotificationBadge();
                    }
                    
                    showNotificationToast('Aviso', 'Notifica√ß√£o exclu√≠da localmente', 'warning');
                }
            });
        };

        // Mark all notifications as read
        document.getElementById('markAllAsReadBtn').addEventListener('click', async () => {
            if (!currentUser) return;
            
            showConfirmDialog('Marcar todas as notifica√ß√µes como lidas?', async () => {
                const unreadNotifications = notifications.filter(n => !n.read);
                let successCount = 0;
                let localFallbackCount = 0;

                for (const notification of unreadNotifications) {
                    try {
                        await update(ref(database, `notifications/${currentUser.uid}/${notification.id}`), {
                            read: true,
                            readAt: Date.now()
                        });
                        successCount++;
                    } catch (error) {
                        addToLocalReadNotifications(notification.id);
                        notification.read = true;
                        localFallbackCount++;
                    }
                }

                if (localFallbackCount === 0) {
                    showNotificationToast('Sucesso', 'Todas as notifica√ß√µes foram marcadas como lidas', 'success');
                } else {
                    showNotificationToast('Aviso', `${successCount} online, ${localFallbackCount} localmente`, 'warning');
                }

                renderNotifications();
                updateNotificationBadge();
            });
        });

        // Delete all notifications
        document.getElementById('deleteAllNotificationsBtn').addEventListener('click', async () => {
            if (!currentUser) return;
            
            showConfirmDialog('Tem certeza que deseja excluir TODAS as notifica√ß√µes?', async () => {
                try {
                    await remove(ref(database, `notifications/${currentUser.uid}`));
                    console.log('‚úÖ All notifications deleted');
                    showNotificationToast('Sucesso', 'Todas as notifica√ß√µes foram exclu√≠das', 'success');
                } catch (error) {
                    console.error('‚ùå Error deleting all notifications:', error);
                    
                    notifications.forEach(notification => {
                        addToLocalDeletedNotifications(notification.id);
                    });
                    
                    notifications = [];
                    renderNotifications();
                    updateNotificationBadge();
                    
                    showNotificationToast('Aviso', 'Notifica√ß√µes exclu√≠das localmente', 'warning');
                }
            });
        });

        // Enhanced custom confirmation dialog
        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="card-bg p-8 rounded-2xl shadow-2xl max-w-sm w-full mx-4 animate-scale-in border">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl text-white">‚ö†Ô∏è</span>
                        </div>
                        <p class="text-gray-700 dark:text-gray-300 text-lg">${message}</p>
                    </div>
                    <div class="flex space-x-4">
                        <button id="cancelBtn" class="flex-1 btn-secondary py-3 rounded-xl hover-lift">Cancelar</button>
                        <button id="confirmBtn" class="flex-1 bg-red-500 text-white py-3 rounded-xl hover-lift ripple">Confirmar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('#cancelBtn').onclick = () => modal.remove();
            modal.querySelector('#confirmBtn').onclick = () => {
                modal.remove();
                onConfirm();
            };
        }

        // Update search visibility
        function updateSearchVisibility() {
            var searchWrapper = document.getElementById('searchWrapper');
            var searchContainer = document.getElementById('searchContainer');

            if (currentSection === 'home') {
                searchWrapper.classList.remove('hidden');
            } else {
                searchWrapper.classList.add('hidden');
                closeInlineSearch();
            }
        }

        // Inline search open/close helpers
        function openInlineSearch() {
            var headerLeft = document.getElementById('headerLeft');
            var headerRight = document.getElementById('headerRight');
            var searchContainer = document.getElementById('searchContainer');
            var searchInput = document.getElementById('searchInput');

            // Hide logo+nav and right actions
            headerLeft.classList.add('header-left-hidden');
            headerRight.classList.add('header-right-hidden');

            // Show inline search
            searchContainer.classList.remove('hidden');
            requestAnimationFrame(function() {
                searchContainer.classList.add('search-active');
            });
            setTimeout(function() { searchInput.focus(); }, 150);
        }

        function closeInlineSearch() {
            var headerLeft = document.getElementById('headerLeft');
            var headerRight = document.getElementById('headerRight');
            var searchContainer = document.getElementById('searchContainer');
            var searchInput = document.getElementById('searchInput');

            searchContainer.classList.remove('search-active');

            setTimeout(function() {
                searchContainer.classList.add('hidden');
                headerLeft.classList.remove('header-left-hidden');
                headerRight.classList.remove('header-right-hidden');
            }, 250);

            // Clear search and re-filter
            searchInput.value = '';
            if (typeof filterProducts === 'function') {
                filterProducts();
            }
        }

        // Search toggle functionality
        (function() {
            var searchToggleBtn = document.getElementById('searchToggleBtn');
            var searchCloseBtn = document.getElementById('searchCloseBtn');
            var searchInput = document.getElementById('searchInput');

            searchToggleBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                openInlineSearch();
            });

            searchCloseBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                closeInlineSearch();
            });

            // Close search on Escape key
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeInlineSearch();
                }
            });
        })();

        // Enhanced chat functionality with corrected user loading and overlay
        function initializeChat() {
            if (!currentUser) return;

            // Listen for admin-initiated chats
            const userChatsRef = ref(database, `chats/users/${currentUser.uid}`);
            onValue(userChatsRef, (snapshot) => {
                const chatData = snapshot.val();
                if (chatData && chatData.active) {
                    currentChatId = chatData.chatId;
                    updateChatStatus(true);
                    loadChatMessages();
                } else {
                    currentChatId = null;
                    updateChatStatus(false);
                }
            });
        }

        function updateChatStatus(isActive) {
            const statusHTML = isActive ? `
                <span class="inline-flex items-center px-3 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                    Chat ativo
                </span>
            ` : `
                <span class="inline-flex items-center px-3 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400">
                    <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                    Chat offline
                </span>
            `;

            if (isActive) {
                // Full chat status
                document.getElementById('chatFullStatus').innerHTML = statusHTML;
                document.getElementById('adminOnlineFullStatus').classList.remove('hidden');
                document.getElementById('chatFullInputContainer').classList.remove('hidden');
                
                // Overlay chat status
                document.getElementById('chatOverlayStatus').innerHTML = statusHTML;
                document.getElementById('chatOverlayInputContainer').classList.remove('hidden');
                
                // Profile chat status
                const chatStatus = document.getElementById('chatStatus');
                if (chatStatus) {
                    chatStatus.innerHTML = statusHTML;
                }
                
                // Show notification
                const chatNotifEl = document.getElementById('chatNotification');
                if (chatNotifEl) chatNotifEl.classList.remove('hidden');
                document.getElementById('footerChatNotification').classList.remove('hidden');
                
                const activeMessage = `
                    <div class="text-center text-gray-500 dark:text-gray-400 mb-4">
                        <div class="bg-green-50 dark:bg-green-900 rounded-2xl p-6 border border-green-200 dark:border-green-700 animate-bounce-in inline-block">
                            <p class="text-green-700 dark:text-green-400 text-lg mb-2">‚úÖ Chat iniciado pelo administrador</p>
                            <p class="text-sm">Voc√™ pode conversar agora sobre seus pedidos</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('chatFullMessages').innerHTML = activeMessage;
                document.getElementById('chatOverlayMessages').innerHTML = activeMessage;
                
                // Show toast notification
                showNotificationToast('Chat Ativo', 'O administrador iniciou um chat com voc√™', 'success');
            } else {
                // Update all chat interfaces to offline state
                document.getElementById('chatFullStatus').innerHTML = statusHTML;
                document.getElementById('adminOnlineFullStatus').classList.add('hidden');
                document.getElementById('chatFullInputContainer').classList.add('hidden');
                
                document.getElementById('chatOverlayStatus').innerHTML = statusHTML;
                document.getElementById('chatOverlayInputContainer').classList.add('hidden');
                
                const chatStatus = document.getElementById('chatStatus');
                if (chatStatus) {
                    chatStatus.innerHTML = statusHTML;
                }
                
                // Hide notification
                const chatNotifElOff = document.getElementById('chatNotification');
                if (chatNotifElOff) chatNotifElOff.classList.add('hidden');
                document.getElementById('footerChatNotification').classList.add('hidden');
                
                const offlineMessage = `
                    <div class="text-center text-gray-500 dark:text-gray-400">
                        <div class="card-bg rounded-2xl p-6 border inline-block animate-fade-in">
                            <p class="mb-2 text-lg">üí¨ Chat de Suporte</p>
                            <p class="text-sm">O administrador ir√° iniciar o chat quando necess√°rio para confirmar detalhes dos seus pedidos</p>
                            <div class="mt-4 flex items-center justify-center">
                                <span class="w-3 h-3 bg-gray-400 rounded-full mr-2 animate-pulse"></span>
                                <span class="text-sm">Aguardando...</span>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('chatFullMessages').innerHTML = offlineMessage;
                document.getElementById('chatOverlayMessages').innerHTML = offlineMessage;
            }
        }

        function loadChatMessages() {
            if (!currentChatId) return;

            const messagesRef = ref(database, `chats/messages/${currentChatId}`);
            onValue(messagesRef, (snapshot) => {
                const messages = snapshot.val() || {};
                const messagesList = Object.entries(messages)
                    .map(([id, msg]) => ({ id, ...msg }))
                    .sort((a, b) => a.timestamp - b.timestamp);

                displayChatMessages(messagesList);
            });
        }

        function displayChatMessages(messages) {
            if (messages.length === 0) {
                const initialMessage = `
                    <div class="text-center text-gray-500 dark:text-gray-400 mb-4">
                        <div class="bg-green-50 dark:bg-green-900 rounded-2xl p-6 border border-green-200 dark:border-green-700 animate-fade-in inline-block">
                            <p class="text-green-700 dark:text-green-400 text-lg mb-2">‚úÖ Chat iniciado pelo administrador</p>
                            <p class="text-sm">Digite sua primeira mensagem abaixo</p>
                        </div>
                    </div>
                `;
                document.getElementById('chatFullMessages').innerHTML = initialMessage;
                document.getElementById('chatOverlayMessages').innerHTML = initialMessage;
                return;
            }

            const messagesHTML = messages.map(msg => {
                const isUser = msg.senderId === currentUser.uid;
                let messageContent = '';
                
                if (msg.type === 'image') {
                    messageContent = `
                        <img src="${msg.imageUrl}" alt="Imagem" class="max-w-full h-auto rounded-lg cursor-pointer hover-lift" 
                             onclick="window.open('${msg.imageUrl}', '_blank')">
                        ${msg.text ? `<p class="text-sm mt-2">${msg.text}</p>` : ''}
                    `;
                } else {
                    messageContent = `<p class="text-sm">${msg.text}</p>`;
                }
                
                return `
                    <div class="flex ${isUser ? 'justify-end' : 'justify-start'} mb-4 animate-fade-in">
                        <div class="${isUser ? 'bg-primary text-white' : 'card-bg border'} 
                                    rounded-2xl px-4 py-3 max-w-xs lg:max-w-md shadow-sm">
                            ${messageContent}
                            <p class="${isUser ? 'text-blue-100' : 'text-gray-500 dark:text-gray-400'} text-xs mt-2">
                                ${new Date(msg.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');

            // Update all chat interfaces
            document.getElementById('chatFullMessages').innerHTML = messagesHTML;
            document.getElementById('chatOverlayMessages').innerHTML = messagesHTML;

            // Scroll to bottom
            setTimeout(() => {
                const chatFullContainer = document.getElementById('chatFullContainer');
                const chatOverlayContainer = document.getElementById('chatOverlayContainer');
                chatFullContainer.scrollTop = chatFullContainer.scrollHeight;
                chatOverlayContainer.scrollTop = chatOverlayContainer.scrollHeight;
            }, 100);
        }

        async function sendChatMessage(messageText = null, imageUrl = null) {
            if (!currentChatId || (!messageText && !imageUrl)) return;

            try {
                const messageData = {
                    senderId: currentUser.uid,
                    senderName: currentUser.displayName || currentUser.email,
                    timestamp: Date.now(),
                    read: false
                };

                if (imageUrl) {
                    messageData.type = 'image';
                    messageData.imageUrl = imageUrl;
                    messageData.text = messageText || '';
                } else {
                    messageData.type = 'text';
                    messageData.text = messageText;
                }

                await push(ref(database, `chats/messages/${currentChatId}`), messageData);
            } catch (error) {
                console.error('Error sending message:', error);
                showNotificationToast('Erro', 'Erro ao enviar mensagem. Tente novamente.', 'error');
            }
        }

        // Chat overlay handlers
        document.getElementById('closeChatOverlayBtn').addEventListener('click', () => {
            closeChatOverlay();
        });

        function openChatOverlay() {
            const overlay = document.getElementById('chatOverlay');
            const messagesEl = document.getElementById('chatOverlayMessages');
            const inputContainer = document.getElementById('chatOverlayInputContainer');

            // Verifica√ß√£o de login: mostrar mensagem se n√£o estiver logado
            if (!currentUser && !isGuest) {
                messagesEl.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üîë</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Login Necess√°rio</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-6">Fa√ßa login para usar o chat</p>
                        <button onclick="closeChatOverlay(); showLoginScreen();" class="btn-primary text-white px-8 py-4 rounded-xl hover-lift ripple">
                            Fazer Login
                        </button>
                    </div>
                `;
                inputContainer.classList.add('hidden');
            } else {
                isFullChatMode = true;
            }

            overlay.classList.remove('hidden');
            overlay.style.opacity = '0';
            overlay.style.transform = 'translateY(24px)';
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    overlay.style.opacity = '1';
                    overlay.style.transform = 'translateY(0)';
                });
            });
        }

        function closeChatOverlay() {
            const overlay = document.getElementById('chatOverlay');
            overlay.style.opacity = '0';
            overlay.style.transform = 'translateY(24px)';
            setTimeout(() => {
                overlay.classList.add('hidden');
                overlay.style.opacity = '';
                overlay.style.transform = '';
            }, 300);
        }

        // Enhanced chat image upload handlers for all interfaces
        function setupChatImageHandlers() {
            // Full chat
            document.getElementById('chatFullImageBtn').addEventListener('click', () => {
                document.getElementById('chatFullImageInput').click();
            });
            document.getElementById('chatFullImageInput').addEventListener('change', async (e) => {
                await handleImageUpload(e, document.getElementById('chatFullImageBtn'));
            });

            // Overlay chat
            document.getElementById('chatOverlayImageBtn').addEventListener('click', () => {
                document.getElementById('chatOverlayImageInput').click();
            });
            document.getElementById('chatOverlayImageInput').addEventListener('change', async (e) => {
                await handleImageUpload(e, document.getElementById('chatOverlayImageBtn'));
            });

            async function handleImageUpload(e, btnElement) {
                const file = e.target.files[0];
                if (!file) return;

                // Show loading state
                btnElement.innerHTML = '‚è≥';
                btnElement.disabled = true;

                try {
                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();
                    if (result.success) {
                        await sendChatMessage(null, result.data.url);
                    } else {
                        showNotificationToast('Erro', 'Erro ao fazer upload da imagem.', 'error');
                    }
                } catch (error) {
                    console.error('Image upload error:', error);
                    showNotificationToast('Erro', 'Erro ao fazer upload da imagem.', 'error');
                } finally {
                    // Reset button state
                    btnElement.innerHTML = 'üì∑';
                    btnElement.disabled = false;
                    e.target.value = '';
                }
            }
        }

        // Enhanced chat event handlers for all interfaces
        function setupChatEventHandlers() {
            // Full chat handlers
            document.getElementById('sendChatFullBtn').addEventListener('click', () => {
                const messageText = document.getElementById('chatFullInput').value.trim();
                if (messageText) {
                    sendChatMessage(messageText);
                    document.getElementById('chatFullInput').value = '';
                }
            });

            document.getElementById('chatFullInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const messageText = document.getElementById('chatFullInput').value.trim();
                    if (messageText) {
                        sendChatMessage(messageText);
                        document.getElementById('chatFullInput').value = '';
                    }
                }
            });

            // Overlay chat handlers
            document.getElementById('sendChatOverlayBtn').addEventListener('click', () => {
                const messageText = document.getElementById('chatOverlayInput').value.trim();
                if (messageText) {
                    sendChatMessage(messageText);
                    document.getElementById('chatOverlayInput').value = '';
                }
            });

            document.getElementById('chatOverlayInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const messageText = document.getElementById('chatOverlayInput').value.trim();
                    if (messageText) {
                        sendChatMessage(messageText);
                        document.getElementById('chatOverlayInput').value = '';
                    }
                }
            });

            // Open chat overlay button
            const openFullChatBtn = document.createElement('button');
            openFullChatBtn.className = 'w-full btn-secondary py-3 rounded-xl hover-lift text-sm';
            openFullChatBtn.innerHTML = 'üí¨ Abrir Chat em Tela Cheia';
            openFullChatBtn.addEventListener('click', () => {
                openChatOverlay();
            });

            // Add smooth transitions for chat interactions
            const chatInputs = [document.getElementById('chatFullInput'), document.getElementById('chatOverlayInput')];
            chatInputs.forEach(input => {
                if (input) {
                    input.addEventListener('focus', function() {
                        this.style.transform = 'scale(1.02)';
                    });
                    input.addEventListener('blur', function() {
                        this.style.transform = 'scale(1)';
                    });
                }
            });
        }

        // Load orders for the user with enhanced status support
        function loadUserOrders() {
            if (!currentUser) return;
            
            const ordersRef = ref(database, 'orders');
            onValue(ordersRef, (snapshot) => {
                const allOrders = snapshot.val() || {};
                const userOrders_array = Object.entries(allOrders)
                    .filter(([id, order]) => order.customer && order.customer.userId === currentUser.uid)
                    .map(([id, order]) => ({ id, ...order }))
                    .sort((a, b) => b.createdAt - a.createdAt);
                
                orders = userOrders_array.reduce((acc, order) => {
                    acc[order.id] = order;
                    return acc;
                }, {});
                
                console.log('User orders loaded:', userOrders_array.length);
                displayUserOrders(userOrders_array);
                displayOrdersInGrid(userOrders_array);
            });
        }

        function displayUserOrders(userOrders_array) {
            const userOrders = document.getElementById('userOrders');
            
            if (userOrders_array.length === 0) {
                userOrders.innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400 animate-fade-in">
                        <div class="text-6xl mb-4 animate-float">üì¶</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Nenhum pedido ainda</h3>
                        <p>Voc√™ ainda n√£o fez nenhum pedido</p>
                    </div>
                `;
            } else {
                // Show only the latest 3 orders in profile
                const recentOrders = userOrders_array.slice(0, 3);
                userOrders.innerHTML = recentOrders.map(order => {
                    const statusColor = getOrderStatusColor(order.status);
                    const statusText = getOrderStatusText(order.status);
                    
                    return `
                        <div class="card-bg rounded-2xl p-6 border animate-fade-in hover-lift">
                            <div class="flex justify-between items-start mb-4">
                                <span class="font-bold text-gray-800 dark:text-gray-200">Pedido #${order.id.slice(-6)}</span>
                                <span class="text-sm px-3 py-1 rounded-full ${statusColor}">
                                    ${statusText}
                                </span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-3">
                                ${order.items.length} item(s) ‚Ä¢ ${formatPrice(order.total)}
                            </p>
                            <div class="text-sm text-gray-500 dark:text-gray-500 mb-3">
                                ${new Date(order.createdAt).toLocaleDateString('pt-BR')} √†s ${new Date(order.createdAt).toLocaleTimeString('pt-BR')}
                            </div>
                            ${getOrderStatusMessage(order.status)}
                        </div>
                    `;
                }).join('');
            }
        }

        function displayOrdersInGrid(userOrders_array) {
            const ordersGrid = document.getElementById('ordersGrid');
            
            if (userOrders_array.length === 0) {
                ordersGrid.innerHTML = `
                    <div class="text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üì¶</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Nenhum pedido ainda</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-6">Voc√™ ainda n√£o fez nenhum pedido</p>
                        <button onclick="showSection('home')" class="btn-primary text-white px-8 py-4 rounded-xl hover-lift ripple">
                            üõí Fazer Primeiro Pedido
                        </button>
                    </div>
                `;
            } else {
                ordersGrid.innerHTML = userOrders_array.map(order => {
                    const statusColor = getOrderStatusColor(order.status);
                    const statusText = getOrderStatusText(order.status);
                    
                    return `
                        <div class="card-bg rounded-2xl border p-8 animate-fade-in hover-lift">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">Pedido #${order.id.slice(-6)}</h3>
                                    <p class="text-gray-600 dark:text-gray-400">${new Date(order.createdAt).toLocaleString('pt-BR')}</p>
                                </div>
                                <span class="px-4 py-2 rounded-full text-sm font-medium ${statusColor}">
                                    ${statusText}
                                </span>
                            </div>
                            
                            <div class="space-y-4 mb-6">
                                <div>
                                    <h4 class="font-bold text-gray-800 dark:text-gray-200 mb-3">Itens (${order.items.length})</h4>
                                    <div class="space-y-2">
                                        ${order.items.slice(0, 3).map(item => `
                                            <p class="text-gray-600 dark:text-gray-400">
                                                ${item.quantity}x ${item.name} - ${formatPrice(item.price)}
                                            </p>
                                        `).join('')}
                                        ${order.items.length > 3 ? `<p class="text-gray-500 dark:text-gray-500">+${order.items.length - 3} mais...</p>` : ''}
                                    </div>
                                </div>
                                
                                <div class="pt-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="flex justify-between items-center">
                                        <span class="font-bold text-gray-800 dark:text-gray-200">Total:</span>
                                        <span class="text-2xl font-bold gradient-text">${formatPrice(order.total)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center text-sm">
                                ${getOrderStatusMessage(order.status)}
                                <span class="text-gray-500 dark:text-gray-500">
                                    ${new Date(order.createdAt).toLocaleDateString('pt-BR')}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function getOrderStatusColor(status) {
            switch (status) {
                case 'pending':
                    return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                case 'approved':
                    return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                case 'delivered':
                    return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                case 'rejected':
                    return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                default:
                    return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200';
            }
        }

        function getOrderStatusText(status) {
            switch (status) {
                case 'pending':
                    return 'Pendente';
                case 'approved':
                    return 'Aprovado';
                case 'delivered':
                    return 'Entregue';
                case 'rejected':
                    return 'Rejeitado';
                default:
                    return 'Desconhecido';
            }
        }

        function getOrderStatusMessage(status) {
            switch (status) {
                case 'pending':
                    return '<p class="text-blue-600 dark:text-blue-400">‚è≥ Aguardando aprova√ß√£o do administrador</p>';
                case 'approved':
                    return '<p class="text-blue-600 dark:text-blue-400">‚úÖ Pedido aprovado! Entraremos em contato em breve</p>';
                case 'delivered':
                    return '<p class="text-green-600 dark:text-green-400">üéâ Pedido entregue com sucesso!</p>';
                case 'rejected':
                    return '<p class="text-red-600 dark:text-red-400">‚ùå Pedido rejeitado. Entre em contato conosco para mais informa√ß√µes</p>';
                default:
                    return '<p class="text-gray-600 dark:text-gray-400">‚ùì Status desconhecido</p>';
            }
        }

        // Enhanced navigation with smooth transitions
        function showSection(section) {
            // Chat agora abre como overlay tela cheia (igual ao checkout)
            if (section === 'chatFull') {
                openChatOverlay();
                return;
            }
            currentSection = section;
            updateSearchVisibility();
            
            // Hide all sections
            const sections = ['homeSection', 'categoriesSection', 'favoritesSection', 'ordersSection', 'chatFullSection', 'profileSection', 'notificationsSection'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'text-white');
                btn.classList.add('btn-secondary');
            });
            // Reset footer nav items
            document.querySelectorAll('.footer-nav-item').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section and update nav
            let targetSection, navBtn, footerBtn;
            
            switch (section) {
                case 'home':
                    targetSection = document.getElementById('homeSection');
                    navBtn = document.getElementById('homeBtn');
                    footerBtn = document.getElementById('footerHomeBtn');
                    break;
                case 'categories':
                    targetSection = document.getElementById('categoriesSection');
                    navBtn = document.getElementById('categoriesBtn');
                    footerBtn = document.getElementById('footerCategoriesBtn');
                    break;
                case 'favorites':
                    targetSection = document.getElementById('favoritesSection');
                    navBtn = document.getElementById('favoritesBtn');
                    footerBtn = document.getElementById('footerFavoritesBtn');
                    renderFavorites();
                    break;
                case 'orders':
                    targetSection = document.getElementById('ordersSection');
                    navBtn = document.getElementById('ordersBtn');
                    footerBtn = document.getElementById('footerOrdersBtn');
                    if (currentUser && !isGuest) {
                        loadUserOrders();
                    } else {
                        document.getElementById('ordersGrid').innerHTML = `
                            <div class="text-center py-20 animate-fade-in">
                                <div class="text-8xl mb-6 animate-float">üîë</div>
                                <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Login Necess√°rio</h3>
                                <p class="text-gray-500 dark:text-gray-400 mb-6">Fa√ßa login para ver seus pedidos</p>
                                <button onclick="showLoginScreen()" class="btn-primary text-white px-8 py-4 rounded-xl hover-lift ripple">
                                    Fazer Login
                                </button>
                            </div>
                        `;
                    }
                    break;
                case 'chatFull':
                    targetSection = document.getElementById('chatFullSection');
                    navBtn = document.getElementById('chatFullBtn');
                    footerBtn = document.getElementById('footerChatBtn');
                    if (currentUser && !isGuest) {
                        isFullChatMode = true;
                    } else {
                        document.getElementById('chatFullMessages').innerHTML = `
                            <div class="text-center text-gray-500 dark:text-gray-400 py-20 animate-fade-in">
                                <div class="text-8xl mb-6 animate-float">üîë</div>
                                <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Login Necess√°rio</h3>
                                <p class="text-gray-500 dark:text-gray-400 mb-6">Fa√ßa login para usar o chat</p>
                                <button onclick="showLoginScreen()" class="btn-primary text-white px-8 py-4 rounded-xl hover-lift ripple">
                                    Fazer Login
                                </button>
                            </div>
                        `;
                    }
                    break;
                case 'notifications':
                    targetSection = document.getElementById('notificationsSection');
                    navBtn = document.getElementById('notificationsBtn');
                    if (currentUser && !isGuest) {
                        loadNotifications();
                    } else {
                        document.getElementById('notificationsList').innerHTML = `
                            <div class="text-center py-20 animate-fade-in">
                                <div class="text-8xl mb-6 animate-float">üîë</div>
                                <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Login Necess√°rio</h3>
                                <p class="text-gray-500 dark:text-gray-400 mb-6">Fa√ßa login para ver suas notifica√ß√µes</p>
                                <button onclick="showLoginScreen()" class="btn-primary text-white px-8 py-4 rounded-xl hover-lift ripple">
                                    Fazer Login
                                </button>
                            </div>
                        `;
                    }
                    break;
                case 'profile':
                    targetSection = document.getElementById('profileSection');
                    if (currentUser && !isGuest) {
                        loadUserProfile();
                    } else {
                        document.getElementById('profileAvatar').src = 'https://via.placeholder.com/80?text=üë§';
                        document.getElementById('profileName').textContent = isGuest ? 'Visitante' : 'Usu√°rio';
                        document.getElementById('profileEmail').textContent = isGuest ? 'Navegando como visitante' : 'Fa√ßa login para ver seu perfil';
                        document.getElementById('userOrders').innerHTML = `
                            <div class="text-center py-12 text-gray-500 dark:text-gray-400 animate-fade-in">
                                <div class="text-6xl mb-4 animate-float">üîë</div>
                                <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Login Necess√°rio</h3>
                                <p class="mb-4">${isGuest ? 'Fa√ßa login para ver seus pedidos e gerenciar seu perfil' : 'Fa√ßa login para ver seus pedidos'}</p>
                                <button onclick="showLoginScreen()" class="btn-primary text-white px-6 py-3 rounded-xl hover-lift ripple">
                                    Fazer Login
                                </button>
                            </div>
                        `;
                    }
                    break;
            }

            // Show target section with animation
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.style.opacity = '0';
                targetSection.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    targetSection.style.opacity = '1';
                    targetSection.style.transform = 'translateY(0)';
                }, 50);
            }

            // Update navigation button states
            if (navBtn) {
                navBtn.classList.remove('btn-secondary');
                navBtn.classList.add('btn-primary', 'text-white');
            }
            if (footerBtn) {
                footerBtn.classList.add('active');
            }
        }

        // ===== Sistema de tradu√ß√£o de erros Firebase =====
        function getFirebaseErrorMessage(error) {
            const code = error.code || '';
            const errorMap = {
                'auth/invalid-email': {
                    msg: 'O endere√ßo de email n√£o √© v√°lido.',
                    hint: 'Verifique se digitou o email corretamente (ex: nome@email.com)'
                },
                'auth/user-disabled': {
                    msg: 'Esta conta foi desativada.',
                    hint: 'Entre em contato com o suporte para mais informa√ß√µes.'
                },
                'auth/user-not-found': {
                    msg: 'Nenhuma conta encontrada com este email.',
                    hint: 'Verifique o email ou crie uma nova conta.'
                },
                'auth/wrong-password': {
                    msg: 'Senha incorreta.',
                    hint: 'Verifique sua senha e tente novamente.'
                },
                'auth/invalid-credential': {
                    msg: 'Email ou senha incorretos.',
                    hint: 'Verifique suas credenciais. Se usou login com Google, tente o bot√£o "Continuar com Google".'
                },
                'auth/email-already-in-use': {
                    msg: 'Este email j√° est√° em uso.',
                    hint: 'Tente fazer login ou use outro email para criar uma conta.'
                },
                'auth/weak-password': {
                    msg: 'A senha √© muito fraca.',
                    hint: 'Use pelo menos 6 caracteres com letras e n√∫meros.'
                },
                'auth/too-many-requests': {
                    msg: 'Muitas tentativas de login.',
                    hint: 'Aguarde alguns minutos antes de tentar novamente.'
                },
                'auth/network-request-failed': {
                    msg: 'Erro de conex√£o com a internet.',
                    hint: 'Verifique sua conex√£o e tente novamente.'
                },
                'auth/popup-closed-by-user': {
                    msg: 'A janela de login foi fechada.',
                    hint: 'Clique no bot√£o novamente para abrir a janela de autentica√ß√£o.'
                },
                'auth/popup-blocked': {
                    msg: 'A janela de login foi bloqueada pelo navegador.',
                    hint: 'Permita pop-ups para este site nas configura√ß√µes do navegador.'
                },
                'auth/cancelled-popup-request': {
                    msg: 'Opera√ß√£o cancelada.',
                    hint: 'Uma nova tentativa de login foi iniciada.'
                },
                'auth/account-exists-with-different-credential': {
                    msg: 'J√° existe uma conta com este email usando outro m√©todo.',
                    hint: 'Tente fazer login com Google ou com email/senha.'
                },
                'auth/operation-not-allowed': {
                    msg: 'Este m√©todo de login n√£o est√° habilitado.',
                    hint: 'Entre em contato com o suporte.'
                },
                'auth/requires-recent-login': {
                    msg: 'Fa√ßa login novamente para continuar.',
                    hint: 'Por seguran√ßa, √© necess√°rio fazer login recente.'
                },
                'auth/internal-error': {
                    msg: 'Erro interno do servidor.',
                    hint: 'Tente novamente em alguns instantes.'
                },
                'auth/missing-password': {
                    msg: 'A senha √© obrigat√≥ria.',
                    hint: 'Digite sua senha para continuar.'
                }
            };

            return errorMap[code] || {
                msg: 'Ocorreu um erro inesperado.',
                hint: 'Tente novamente. Se o problema persistir, entre em contato com o suporte.'
            };
        }

        function showLoginError(error) {
            const { msg, hint } = getFirebaseErrorMessage(error);
            const banner = document.getElementById('loginErrorBanner');
            document.getElementById('loginErrorText').textContent = msg;
            document.getElementById('loginErrorHint').textContent = hint;
            banner.classList.remove('hidden');
            // Re-trigger shake animation
            banner.style.animation = 'none';
            void banner.offsetHeight; // force reflow
            banner.style.animation = '';
        }

        function hideLoginError() {
            document.getElementById('loginErrorBanner').classList.add('hidden');
        }
        window.hideLoginError = hideLoginError;

        function setLoginBtnLoading(btnEl, textEl, loaderEl, loading) {
            if (loading) {
                btnEl.classList.add('login-btn-loading');
                textEl.classList.add('hidden');
                loaderEl.classList.remove('hidden');
            } else {
                btnEl.classList.remove('login-btn-loading');
                textEl.classList.remove('hidden');
                loaderEl.classList.add('hidden');
            }
        }

        // ===== Authentication handlers =====
        const guestBtn = document.getElementById('guestBtn');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const showEmailLoginBtn = document.getElementById('showEmailLoginBtn');
        const backToOptionsBtn = document.getElementById('backToOptionsBtn');
        const showRegisterBtn = document.getElementById('showRegisterBtn');
        const backToLoginBtn = document.getElementById('backToLoginBtn');
        const showForgotPasswordBtn = document.getElementById('showForgotPasswordBtn');
        const backToLoginFromForgotBtn = document.getElementById('backToLoginFromForgotBtn');
        const forgotPasswordFormEl = document.getElementById('forgotPasswordFormEl');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginOptions = document.getElementById('loginOptions');
        const emailLoginForm = document.getElementById('emailLoginForm');
        const emailRegisterForm = document.getElementById('emailRegisterForm');

        guestBtn.addEventListener('click', () => {
            hideLoginError();
            isGuest = true;
            currentUser = null;
            updateUserUI();
            showMainApp();
            loadData();
            updateCartUI();
        });

        // Fun√ß√£o para login com Google
        async function handleGoogleAuth() {
            const btn = googleLoginBtn;
            const textEl = document.getElementById('googleBtnText');
            const loaderEl = document.getElementById('googleBtnLoader');

            hideLoginError();
            setLoginBtnLoading(btn, textEl, loaderEl, true);

            try {
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                const user = result.user;

                const userDoc = await getDoc(doc(firestore, 'users', user.uid));
                if (!userDoc.exists()) {
                    await setDoc(doc(firestore, 'users', user.uid), {
                        name: user.displayName,
                        email: user.email,
                        photoURL: user.photoURL,
                        createdAt: new Date(),
                        isActive: true
                    });
                }

                await set(ref(database, `users/${user.uid}`), {
                    name: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL,
                    createdAt: Date.now(),
                    isActive: true
                });

                if (user.email === 'sibemcesar@gmail.com') {
                    const adminDoc = await getDoc(doc(firestore, 'admins', user.uid));
                    if (!adminDoc.exists()) {
                        await setDoc(doc(firestore, 'admins', user.uid), {
                            email: user.email,
                            role: 'super_admin',
                            createdAt: new Date()
                        });

                        await set(ref(database, `admins/${user.uid}`), {
                            email: user.email,
                            role: 'super_admin',
                            createdAt: Date.now()
                        });
                    }
                }

                console.log('Google login successful:', user.email);
                showNotificationToast('Sucesso', 'Login realizado com sucesso! Bem-vindo, ' + (user.displayName || user.email), 'success');

            } catch (error) {
                console.error('Login error:', error);
                showLoginError(error);
                showNotificationToast('Erro', getFirebaseErrorMessage(error).msg, 'error');
            } finally {
                setLoginBtnLoading(btn, textEl, loaderEl, false);
            }
        }

        googleLoginBtn.addEventListener('click', () => handleGoogleAuth());

        showEmailLoginBtn.addEventListener('click', () => {
            hideLoginError();
            loginOptions.classList.add('hidden');
            emailLoginForm.classList.remove('hidden');
        });

        backToOptionsBtn.addEventListener('click', () => {
            hideLoginError();
            emailLoginForm.classList.add('hidden');
            loginOptions.classList.remove('hidden');
        });

        showRegisterBtn.addEventListener('click', () => {
            hideLoginError();
            emailLoginForm.classList.add('hidden');
            emailRegisterForm.classList.remove('hidden');
        });

        // Forgot Password navigation
        showForgotPasswordBtn.addEventListener('click', () => {
            hideLoginError();
            emailLoginForm.classList.add('hidden');
            forgotPasswordForm.classList.remove('hidden');
            document.getElementById('forgotPasswordSuccess').classList.add('hidden');
            document.getElementById('forgotPasswordFormEl').classList.remove('hidden');
            document.getElementById('forgotEmail').value = document.getElementById('loginEmail').value || '';
        });

        backToLoginFromForgotBtn.addEventListener('click', () => {
            hideLoginError();
            forgotPasswordForm.classList.add('hidden');
            emailLoginForm.classList.remove('hidden');
        });

        forgotPasswordFormEl.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideLoginError();
            const email = document.getElementById('forgotEmail').value.trim();

            if (!email) {
                showLoginError({ code: 'auth/invalid-email' });
                return;
            }

            const submitBtn = document.getElementById('forgotPasswordSubmitBtn');
            const btnText = document.getElementById('forgotBtnText');
            const btnLoader = document.getElementById('forgotBtnLoader');

            submitBtn.disabled = true;
            btnText.classList.add('hidden');
            btnLoader.classList.remove('hidden');

            try {
                await sendPasswordResetEmail(auth, email);
                document.getElementById('forgotPasswordFormEl').classList.add('hidden');
                document.getElementById('forgotPasswordSuccess').classList.remove('hidden');
                showNotificationToast('Sucesso', 'Email de recupera√ß√£o enviado para ' + email, 'success');
            } catch (error) {
                console.error('Password reset error:', error);
                showLoginError(error);
                showNotificationToast('Erro', getFirebaseErrorMessage(error).msg, 'error');
            } finally {
                submitBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        });

        backToLoginBtn.addEventListener('click', () => {
            hideLoginError();
            emailRegisterForm.classList.add('hidden');
            emailLoginForm.classList.remove('hidden');
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideLoginError();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            // Valida√ß√£o local antes de enviar
            if (!email) {
                showLoginError({ code: 'auth/invalid-email' });
                return;
            }
            if (!password) {
                showLoginError({ code: 'auth/missing-password' });
                return;
            }

            const submitBtn = loginForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="flex items-center justify-center"><div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div>Entrando...</div>';

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showNotificationToast('Sucesso', 'Login realizado com sucesso!', 'success');
            } catch (error) {
                console.error('Login error:', error);
                showLoginError(error);
                showNotificationToast('Erro', getFirebaseErrorMessage(error).msg, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });

        // Profile picture upload for registration
        const profilePictureInput = document.getElementById('profilePicture');
        const previewAvatar = document.getElementById('previewAvatar');

        profilePictureInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                previewAvatar.src = e.target.result;
                previewAvatar.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    previewAvatar.style.transform = 'scale(1)';
                }, 200);
            };
            reader.readAsDataURL(file);

            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    uploadedPhotoURL = result.data.url;
                    console.log('Image uploaded successfully:', uploadedPhotoURL);
                } else {
                    showNotificationToast('Erro', 'Erro ao fazer upload da imagem', 'error');
                }
            } catch (error) {
                console.error('Image upload error:', error);
                showNotificationToast('Erro', 'Erro ao fazer upload da imagem', 'error');
            }
        });

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            const registerBtnText = document.getElementById('registerBtnText');
            const registerBtnLoader = document.getElementById('registerBtnLoader');
            const registerSubmitBtn = document.getElementById('registerSubmitBtn');
            
            registerBtnText.classList.add('hidden');
            registerBtnLoader.classList.remove('hidden');
            registerSubmitBtn.disabled = true;
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                await updateProfile(user, { 
                    displayName: name,
                    photoURL: uploadedPhotoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=5D5CDE&color=fff&size=200`
                });
                
                await setDoc(doc(firestore, 'users', user.uid), {
                    name: name,
                    email: email,
                    photoURL: uploadedPhotoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=5D5CDE&color=fff&size=200`,
                    createdAt: new Date(),
                    isActive: true
                });

                await set(ref(database, `users/${user.uid}`), {
                    name: name,
                    email: email,
                    photoURL: uploadedPhotoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=5D5CDE&color=fff&size=200`,
                    createdAt: Date.now(),
                    isActive: true
                });

                if (email === 'sibemcesar@gmail.com') {
                    await setDoc(doc(firestore, 'admins', user.uid), {
                        email: email,
                        role: 'super_admin',
                        createdAt: new Date()
                    });
                    
                    await set(ref(database, `admins/${user.uid}`), {
                        email: email,
                        role: 'super_admin',
                        createdAt: Date.now()
                    });
                }
                
                showNotificationToast('Sucesso', 'Conta criada com sucesso!', 'success');
                
            } catch (error) {
                console.error('Register error:', error);
                showLoginError(error);
                showNotificationToast('Erro', getFirebaseErrorMessage(error).msg, 'error');
            } finally {
                registerBtnText.classList.remove('hidden');
                registerBtnLoader.classList.add('hidden');
                registerSubmitBtn.disabled = false;
            }
        });

        // Authentication state observer
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user);
            currentUser = user;
            isGuest = false;
            
            if (user) {
                if (cart.length > 0) {
                    localStorage.removeItem('guestCart');
                }
                
                updateUserUI();
                showMainApp();
                loadData();
                loadFavorites();
                loadUserOrders();
                loadNotifications();
                updateCartUI();
                initializeChat();
                setupChatImageHandlers();
                setupChatEventHandlers();
            } else if (!isGuest) {
                showLoginScreen();
            }
        });

        function updateUserUI() {
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userMenu = document.getElementById('userMenu');
            const userMenuContent = document.getElementById('userMenuContent');

            if (currentUser) {
                userAvatar.src = currentUser.photoURL || 'https://via.placeholder.com/32?text=' + (currentUser.displayName?.charAt(0) || 'üë§');
                userName.textContent = currentUser.displayName || currentUser.email;
                
                userMenuContent.innerHTML = `
                    <button id="viewProfileBtn" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üë§</span>Meu Perfil
                    </button>
                    <button id="viewNotificationsBtn" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üîî</span>Notifica√ß√µes
                    </button>
                    <button id="menuOrdersBtn" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üì¶</span>Pedidos
                    </button>
                    <button id="menuChatBtn" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üí¨</span>Chat
                    </button>
                <button
  id="faq"
  class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all"
  onclick="window.location.href='faq.html'">
  <span class="mr-3">üó£Ô∏è</span>FAQ
</button>
                    <button id="menuThemeToggle" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all flex items-center justify-between">
                        <span><span id="menuThemeIcon" class="mr-3">${document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô'}</span>${document.documentElement.classList.contains('dark') ? 'Modo Claro' : 'Modo Escuro'}</span>
                        <div id="themeToggle" class="theme-switch ${document.documentElement.classList.contains('dark') ? 'dark' : ''}" style="width:44px;height:22px;flex-shrink:0;">
                            <span id="themeIcon" class="absolute text-xs" style="left:${document.documentElement.classList.contains('dark') ? '24px' : '3px'};top:2px;">${document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô'}</span>
                        </div>
                    </button>
                    <button id="logoutBtn" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-xl transition-all">
                        <span class="mr-3"></span>Terminar Sess√£o
                    </button>
                `;
                
                document.getElementById('viewProfileBtn').addEventListener('click', () => {
                    showSection('profile');
                    userMenu.classList.add('hidden');
                });
                
                document.getElementById('viewNotificationsBtn').addEventListener('click', () => {
                    showSection('notifications');
                    userMenu.classList.add('hidden');
                });

                document.getElementById('menuOrdersBtn').addEventListener('click', () => {
                    showSection('orders');
                    userMenu.classList.add('hidden');
                });

                document.getElementById('menuChatBtn').addEventListener('click', () => {
                    showSection('chatFull');
                    userMenu.classList.add('hidden');
                });

                document.getElementById('menuThemeToggle').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleTheme();
                    updateUserUI();
                });

                document.getElementById('logoutBtn').addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        cart = [];
                        favorites = [];
                        orders = {};
                        notifications = [];
                        updateCartUI();
                    } catch (error) {
                        console.error('Logout error:', error);
                    }
                });

            } else if (isGuest) {
                userAvatar.src = 'https://via.placeholder.com/32?text=üë§';
                userName.textContent = 'Visitante';
                
                userMenuContent.innerHTML = `
                    <button id="guestLoginBtn" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üîë</span>Fazer Login
                    </button>
                    <button id="menuOrdersBtnGuest" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üì¶</span>Pedidos
                    </button>
                    <button id="menuChatBtnGuest" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b transition-all">
                        <span class="mr-3">üí¨</span>Chat
                    </button>
                    <button id="menuThemeToggleGuest" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-xl transition-all flex items-center justify-between">
                        <span><span class="mr-3">${document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô'}</span>${document.documentElement.classList.contains('dark') ? 'Modo Claro' : 'Modo Escuro'}</span>
                        <div id="themeToggle" class="theme-switch ${document.documentElement.classList.contains('dark') ? 'dark' : ''}" style="width:44px;height:22px;flex-shrink:0;">
                            <span id="themeIcon" class="absolute text-xs" style="left:${document.documentElement.classList.contains('dark') ? '24px' : '3px'};top:2px;">${document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô'}</span>
                        </div>
                    </button>
                `;

                document.getElementById('guestLoginBtn').addEventListener('click', () => {
                    showLoginScreen();
                    userMenu.classList.add('hidden');
                });

                document.getElementById('menuOrdersBtnGuest').addEventListener('click', () => {
                    showSection('orders');
                    userMenu.classList.add('hidden');
                });

                document.getElementById('menuChatBtnGuest').addEventListener('click', () => {
                    showSection('chatFull');
                    userMenu.classList.add('hidden');
                });

                document.getElementById('menuThemeToggleGuest').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleTheme();
                    updateUserUI();
                });
            }
        }

        // User menu toggle
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userMenu = document.getElementById('userMenu');

        userMenuBtn.addEventListener('click', () => {
            userMenu.classList.toggle('hidden');
        });

        document.addEventListener('click', (e) => {
            if (!userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Cart functionality
        const cartSidebar = document.getElementById('cartSidebar');
        const cartOverlay = document.getElementById('cartOverlay');
        const closeCartBtn = document.getElementById('closeCartBtn');
        const footerCartBtn = document.getElementById('footerCartBtn');

        footerCartBtn.addEventListener('click', openCart);
        closeCartBtn.addEventListener('click', closeCart);
        cartOverlay.addEventListener('click', closeCart);

        function openCart() {
            cartSidebar.style.transform = 'translateX(100%)';
            cartSidebar.classList.remove('translate-x-full');
            cartOverlay.classList.remove('hidden');
            
            setTimeout(() => {
                cartSidebar.style.transform = 'translateX(0)';
            }, 50);
        }

        function closeCart() {
            cartSidebar.style.transform = 'translateX(100%)';
            setTimeout(() => {
                cartSidebar.classList.add('translate-x-full');
                cartOverlay.classList.add('hidden');
            }, 300);
        }

        // Navigation event listeners
        document.getElementById('homeBtn')?.addEventListener('click', () => showSection('home'));
        document.getElementById('categoriesBtn')?.addEventListener('click', () => showSection('categories'));
        document.getElementById('favoritesBtn')?.addEventListener('click', () => showSection('favorites'));
        document.getElementById('ordersBtn')?.addEventListener('click', () => showSection('orders'));
        document.getElementById('chatFullBtn')?.addEventListener('click', () => showSection('chatFull'));
        document.getElementById('notificationsBtn')?.addEventListener('click', () => showSection('notifications'));
        
        document.getElementById('footerHomeBtn').addEventListener('click', () => showSection('home'));
        document.getElementById('footerCategoriesBtn').addEventListener('click', () => showSection('categories'));
        document.getElementById('footerFavoritesBtn').addEventListener('click', () => showSection('favorites'));
        document.getElementById('footerOrdersBtn').addEventListener('click', () => showSection('orders'));
        document.getElementById('footerChatBtn').addEventListener('click', () => showSection('chatFull'));

        document.getElementById('viewAllOrdersBtn').addEventListener('click', () => {
            showSection('orders');
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        
        searchInput.addEventListener('input', filterProducts);

        // Checkout functionality
        const checkoutBtn = document.getElementById('checkoutBtn');
        const checkoutModal = document.getElementById('checkoutModal');
        const closeCheckoutBtn = document.getElementById('closeCheckoutBtn');
        const cancelCheckoutBtn = document.getElementById('cancelCheckoutBtn');
        const checkoutForm = document.getElementById('checkoutForm');
        const checkoutLoginBtn = document.getElementById('checkoutLoginBtn');
        const checkoutRegisterBtn = document.getElementById('checkoutRegisterBtn');

        checkoutBtn.addEventListener('click', openCheckout);
        closeCheckoutBtn.addEventListener('click', closeCheckout);
        cancelCheckoutBtn.addEventListener('click', closeCheckout);
        checkoutForm.addEventListener('submit', processOrder);

        checkoutLoginBtn.addEventListener('click', () => {
            closeCheckout();
            showLoginScreen();
        });

        checkoutRegisterBtn.addEventListener('click', () => {
            closeCheckout();
            showEmailLoginBtn.click();
            showRegisterBtn.click();
        });

        // Product detail modal
        const productDetailModal = document.getElementById('productDetailModal');
        const closeDetailModalBtn = document.getElementById('closeDetailModalBtn');

        closeDetailModalBtn.addEventListener('click', closeProductDetail);

        function openCheckout() {
            if (cart.length === 0) return;
            
            if (!currentUser && !isGuest) {
                showNotificationToast('Aviso', 'Fa√ßa login para finalizar a compra', 'warning');
                return;
            }
            
            const loginRequiredMessage = document.getElementById('loginRequiredMessage');
            const checkoutForm = document.getElementById('checkoutForm');
            
            if (isGuest) {
                loginRequiredMessage.classList.remove('hidden');
                checkoutForm.classList.add('hidden');
            } else {
                document.getElementById('customerName').value = currentUser.displayName || '';
                loginRequiredMessage.classList.add('hidden');
                checkoutForm.classList.remove('hidden');
            }
            
            updateCheckoutSummary();
            checkoutModal.classList.remove('hidden');
            checkoutModal.style.opacity = '0';
            checkoutModal.style.transform = 'translateY(24px)';
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    checkoutModal.style.opacity = '1';
                    checkoutModal.style.transform = 'translateY(0)';
                });
            });
        }

        function closeCheckout() {
            checkoutModal.style.opacity = '0';
            checkoutModal.style.transform = 'translateY(24px)';
            setTimeout(() => {
                checkoutModal.classList.add('hidden');
                checkoutModal.style.opacity = '';
                checkoutModal.style.transform = '';
                checkoutForm.reset();
                document.getElementById('loginRequiredMessage').classList.add('hidden');
                checkoutForm.classList.remove('hidden');
            }, 300);
        }

        function updateCheckoutSummary() {
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const checkoutSummary = document.getElementById('checkoutSummary');
            const checkoutTotal = document.getElementById('checkoutTotal');
            
            checkoutSummary.innerHTML = cart.map(item => `
                <div class="flex justify-between text-sm">
                    <span>${item.name} (${item.quantity}x)</span>
                    <span>${formatPrice(item.price * item.quantity)}</span>
                </div>
            `).join('');
            
            checkoutTotal.textContent = formatPrice(totalPrice);
        }

        async function processOrder(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotificationToast('Erro', 'Voc√™ precisa estar logado para finalizar a compra', 'error');
                return;
            }
            
            const orderData = {
                customer: {
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhone').value,
                    location: document.getElementById('customerLocation').value,
                    message: document.getElementById('customerMessage').value,
                    email: currentUser.email,
                    userId: currentUser.uid
                },
                items: cart.map(item => ({
                    productId: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                status: 'pending',
                createdAt: Date.now()
            };
            
            try {
                const newOrderRef = push(ref(database, 'orders'));
                await set(newOrderRef, orderData);
                await setDoc(doc(firestore, 'orders', newOrderRef.key), orderData);
                
                cart = [];
                updateCartUI();
                closeCheckout();
                closeCart();
                
                showNotificationToast('Sucesso', 'Pedido realizado com sucesso! Em breve entraremos em contato.', 'success');
                
                if (currentSection === 'orders' || currentSection === 'profile') {
                    loadUserOrders();
                }
            } catch (error) {
                console.error('Error processing order:', error);
                showNotificationToast('Erro', 'Erro ao processar pedido. Tente novamente.', 'error');
            }
        }

        // Load data from Firebase
        function loadData() {
            const productsRef = ref(database, 'products');
            onValue(productsRef, (snapshot) => {
                products = snapshot.val() || {};
                console.log('Products loaded:', Object.keys(products).length);
                renderProducts();
                updateCategories();
            });
        }

        function loadFavorites() {
            if (currentUser) {
                const favoritesRef = ref(database, `favorites/${currentUser.uid}`);
                onValue(favoritesRef, (snapshot) => {
                    const favoritesData = snapshot.val() || {};
                    favorites = Object.keys(favoritesData);
                    console.log('Favorites loaded:', favorites.length);
                    renderFavorites();
                    if (currentSection === 'home') {
                        renderProducts();
                    }
                });
            }
        }

        async function loadUserProfile() {
            if (!currentUser) return;
            
            try {
                const profileAvatar = document.getElementById('profileAvatar');
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                
                profileAvatar.src = currentUser.photoURL || 'https://via.placeholder.com/80?text=' + (currentUser.displayName?.charAt(0) || 'üë§');
                profileName.textContent = currentUser.displayName || 'Usu√°rio';
                profileEmail.textContent = currentUser.email;
                
                loadUserOrders();
                
            } catch (error) {
                console.error('Error loading user profile:', error);
                document.getElementById('userOrders').innerHTML = `
                    <div class="text-center py-8 text-red-500 dark:text-red-400">
                        <div class="text-4xl mb-4">‚ùå</div>
                        <p>Erro ao carregar dados do perfil</p>
                    </div>
                `;
            }
        }

        function renderProducts() {
            const productsGrid = document.getElementById('productsGrid');
            const productsArray = Object.entries(products).map(([id, product]) => ({ id, ...product }));
            const searchTerm = (searchInput.value || '').toLowerCase();
            const activeCategory = document.querySelector('.category-filter-btn.btn-primary')?.dataset.category || 'all';
            
            let filteredProducts = productsArray;
            
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description?.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm)
                );
            }
            
            if (activeCategory !== 'all') {
                filteredProducts = filteredProducts.filter(product => product.category === activeCategory);
            }

            if (currentPriceFilter !== 'all') {
                filteredProducts = filteredProducts.filter(product => {
                    const price = product.price;
                    switch (currentPriceFilter) {
                        case '0-1000':
                            return price <= 1000;
                        case '1000-5000':
                            return price > 1000 && price <= 5000;
                        case '5000-10000':
                            return price > 5000 && price <= 10000;
                        case '10000+':
                            return price > 10000;
                        default:
                            return true;
                    }
                });
            }

            document.getElementById('productsCount').textContent = `${filteredProducts.length} produto${filteredProducts.length !== 1 ? 's' : ''} encontrado${filteredProducts.length !== 1 ? 's' : ''}`;

            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div class="col-span-full text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üîç</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Nenhum produto encontrado</h3>
                        <p class="text-gray-500 dark:text-gray-400">Tente ajustar os filtros ou buscar por outros termos</p>
                    </div>
                `;
                return;
            }

            productsGrid.innerHTML = filteredProducts.map(product => {
                const hasDiscount = product.oldPrice && product.oldPrice > product.price;
                const discountPercent = hasDiscount ? Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100) : 0;

                const isFav = favorites.includes(product.id);
                return `
                <div class="card-bg rounded-xl border overflow-hidden hover-lift animate-fade-in group cursor-pointer"
                     onclick="showProductDetail('${product.id}')">
                    <div class="relative h-28 sm:h-32 bg-gray-200 dark:bg-gray-700">
                        ${product.image ?
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">` :
                            `<div class="w-full h-full flex items-center justify-center">
                                <div class="text-2xl text-gray-400 animate-pulse">üñºÔ∏è</div>
                            </div>`
                        }
                        <button onclick="event.stopPropagation(); toggleFavorite('${product.id}')"
                                class="absolute top-1.5 right-1.5 w-7 h-7 rounded-full bg-white/80 dark:bg-black/50 flex items-center justify-center hover:scale-110 transition-transform shadow-sm backdrop-blur-sm"
                                title="${isFav ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}">
                            <span class="text-sm">${isFav ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                        </button>
                        ${hasDiscount ? `
                            <div class="absolute top-1.5 left-1.5 bg-red-500 text-white px-2 py-0.5 rounded-full text-xs font-bold">
                                -${discountPercent}%
                            </div>
                        ` : ''}
                        ${product.stock === 0 ? `
                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                <span class="text-white font-bold bg-red-500 px-2 py-1 rounded-lg text-xs">Esgotado</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-2.5">
                        <h3 class="font-bold text-gray-800 dark:text-gray-200 mb-0.5 text-xs line-clamp-2 leading-tight">${product.name}</h3>
                        <p class="text-[10px] text-gray-600 dark:text-gray-400 mb-1 capitalize">${getCategoryName(product.category)}</p>

                        <div class="flex items-center gap-1 mb-1.5">
                            <span class="text-sm font-bold gradient-text">${formatPrice(product.price)}</span>
                            ${hasDiscount ? `<span class="text-[10px] text-gray-400 line-through">${formatPrice(product.oldPrice)}</span>` : ''}
                        </div>

                        <button onclick="event.stopPropagation(); addToCart('${product.id}')"
                                class="w-full btn-primary text-white py-1.5 rounded-lg hover-lift ripple text-xs ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                ${product.stock === 0 ? 'disabled' : ''}>
                            <span class="mr-1">üõí</span>${product.stock === 0 ? 'Esgotado' : 'Comprar'}
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        function renderFavorites() {
            const favoritesGrid = document.getElementById('favoritesGrid');

            if (!currentUser) {
                favoritesGrid.innerHTML = `
                    <div class="col-span-full text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üîë</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Login Necess√°rio</h3>
                        <p class="text-gray-500 dark:text-gray-400">Fa√ßa login para ver seus favoritos</p>
                    </div>
                `;
                return;
            }

            if (favorites.length === 0) {
                favoritesGrid.innerHTML = `
                    <div class="col-span-full text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">‚ù§Ô∏è</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Nenhum favorito ainda</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-6">Clique no cora√ß√£o dos produtos para adicion√°-los aos favoritos</p>
                        <button onclick="showSection('home')" class="btn-primary text-white px-8 py-4 rounded-xl hover-lift ripple">
                            Ver Produtos
                        </button>
                    </div>
                `;
                return;
            }

            const favoriteProducts = favorites
                .map(id => products[id] ? { id, ...products[id] } : null)
                .filter(p => p !== null);

            if (favoriteProducts.length === 0) {
                favoritesGrid.innerHTML = `
                    <div class="col-span-full text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">‚ù§Ô∏è</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Produtos favoritos n√£o encontrados</h3>
                        <p class="text-gray-500 dark:text-gray-400">Os produtos podem ter sido removidos</p>
                    </div>
                `;
                return;
            }

            favoritesGrid.innerHTML = favoriteProducts.map(product => {
                const hasDiscount = product.oldPrice && product.oldPrice > product.price;
                const discountPercent = hasDiscount ? Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100) : 0;

                return `
                <div class="card-bg rounded-xl border overflow-hidden hover-lift animate-fade-in group cursor-pointer"
                     onclick="showProductDetail('${product.id}')">
                    <div class="relative h-28 sm:h-32 bg-gray-200 dark:bg-gray-700">
                        ${product.image ?
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">` :
                            `<div class="w-full h-full flex items-center justify-center">
                                <div class="text-2xl text-gray-400 animate-pulse">üñºÔ∏è</div>
                            </div>`
                        }
                        <button onclick="event.stopPropagation(); toggleFavorite('${product.id}')"
                                class="absolute top-1.5 right-1.5 w-7 h-7 rounded-full bg-white/80 dark:bg-black/50 flex items-center justify-center hover:scale-110 transition-transform shadow-sm backdrop-blur-sm"
                                title="Remover dos favoritos">
                            <span class="text-sm">‚ù§Ô∏è</span>
                        </button>
                        ${hasDiscount ? `
                            <div class="absolute top-1.5 left-1.5 bg-red-500 text-white px-2 py-0.5 rounded-full text-xs font-bold">
                                -${discountPercent}%
                            </div>
                        ` : ''}
                        ${product.stock === 0 ? `
                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                <span class="text-white font-bold bg-red-500 px-2 py-1 rounded-lg text-xs">Esgotado</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-2.5">
                        <h3 class="font-bold text-gray-800 dark:text-gray-200 mb-0.5 text-xs line-clamp-2 leading-tight">${product.name}</h3>
                        <p class="text-[10px] text-gray-600 dark:text-gray-400 mb-1 capitalize">${getCategoryName(product.category)}</p>

                        <div class="flex items-center gap-1 mb-1.5">
                            <span class="text-sm font-bold gradient-text">${formatPrice(product.price)}</span>
                            ${hasDiscount ? `<span class="text-[10px] text-gray-400 line-through">${formatPrice(product.oldPrice)}</span>` : ''}
                        </div>

                        <button onclick="event.stopPropagation(); addToCart('${product.id}')"
                                class="w-full btn-primary text-white py-1.5 rounded-lg hover-lift ripple text-xs ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                ${product.stock === 0 ? 'disabled' : ''}>
                            <span class="mr-1">üõí</span>${product.stock === 0 ? 'Esgotado' : 'Comprar'}
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        function updateCategories() {
            const productCategories = [...new Set(Object.values(products).map(p => p.category))];
            categories = productCategories;
            
            const categoryFilters = document.getElementById('categoryFilters');
            if (categoryFilters) {
                categoryFilters.innerHTML = `
                    <button class="category-filter-btn btn-primary text-white px-4 py-2 rounded-full text-sm font-medium hover-lift" data-category="all">
                        Todos
                    </button>
                    ${categories.map(category => `
                        <button class="category-filter-btn btn-secondary px-4 py-2 rounded-full text-sm font-medium hover-lift" data-category="${category}">
                            ${getCategoryName(category)}
                        </button>
                    `).join('')}
                `;
                
                document.querySelectorAll('.category-filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.category-filter-btn').forEach(b => {
                            b.classList.remove('btn-primary', 'text-white');
                            b.classList.add('btn-secondary');
                        });
                        btn.classList.remove('btn-secondary');
                        btn.classList.add('btn-primary', 'text-white');
                        renderProducts();
                    });
                });
            }

            document.querySelectorAll('.price-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.price-filter-btn').forEach(b => {
                        b.classList.remove('btn-primary', 'text-white');
                        b.classList.add('btn-secondary');
                    });
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-primary', 'text-white');
                    currentPriceFilter = btn.dataset.price;
                    renderProducts();
                });
            });
            
            renderCategories();
        }

        function renderCategories() {
            const categoriesGrid = document.getElementById('categoriesGrid');

            if (categories.length === 0) {
                categoriesGrid.innerHTML = `
                    <div class="col-span-full text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üìÇ</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Nenhuma categoria dispon√≠vel</h3>
                        <p class="text-gray-500 dark:text-gray-400">As categorias aparecer√£o aqui quando produtos forem adicionados</p>
                    </div>
                `;
                return;
            }

            categoriesGrid.innerHTML = categories.map(category => {
                const categoryProducts = Object.values(products).filter(p => p.category === category);
                const bgImage = getCategoryBackground(category);
                return `
                    <div class="category-card-bg hover-lift animate-fade-in cursor-pointer"
                         style="background-image: ${bgImage};"
                         onclick="filterByCategory('${category}')">
                        <div class="category-card-content">
                            <div class="category-card-icon">${getCategoryIcon(category)}</div>
                            <h3 class="font-bold mb-1 text-xl">${getCategoryName(category)}</h3>
                            <p class="text-sm">${categoryProducts.length} produto${categoryProducts.length !== 1 ? 's' : ''}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Favorites functions
        window.toggleFavorite = async function(productId) {
            if (!currentUser) {
                showNotificationToast('Aviso', 'Fa√ßa login para adicionar favoritos', 'warning');
                return;
            }

            try {
                const userFavoritesRef = ref(database, `favorites/${currentUser.uid}/${productId}`);
                
                if (favorites.includes(productId)) {
                    await remove(userFavoritesRef);
                    console.log('Removed from favorites:', productId);
                    showNotificationToast('Favorito', 'Produto removido dos favoritos', 'info');
                } else {
                    await set(userFavoritesRef, true);
                    console.log('Added to favorites:', productId);
                    showNotificationToast('Favorito', 'Produto adicionado aos favoritos', 'success');
                }
            } catch (error) {
                console.error('Error toggling favorite:', error);
                showNotificationToast('Erro', 'Erro ao atualizar favoritos', 'error');
            }
        };

        // Cart functions
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const footerCartCount = document.getElementById('footerCartCount');

        window.addToCart = function(productId) {
            const product = products[productId];
            if (!product || product.stock === 0) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                }
            } else {
                cart.push({ ...product, id: productId, quantity: 1 });
            }
            
            if (isGuest) {
                localStorage.setItem('guestCart', JSON.stringify(cart));
            }
            
            updateCartUI();
            showNotificationToast('Carrinho', 'Produto adicionado ao carrinho!', 'success');
        };

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            
            if (isGuest) {
                localStorage.setItem('guestCart', JSON.stringify(cart));
            }
            
            updateCartUI();
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;
            
            const product = products[productId];
            const newQuantity = item.quantity + change;
            
            if (newQuantity <= 0) {
                removeFromCart(productId);
            } else if (newQuantity <= product.stock) {
                item.quantity = newQuantity;
                
                if (isGuest) {
                    localStorage.setItem('guestCart', JSON.stringify(cart));
                }
                
                updateCartUI();
            }
        }

        function updateCartUI() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            footerCartCount.textContent = totalItems;
            cartTotal.textContent = formatPrice(totalPrice);
            checkoutBtn.disabled = cart.length === 0;
            
            if (totalItems > 0) {
                footerCartCount.classList.remove('hidden');
                footerCartCount.classList.add('bounce-anim');
                setTimeout(() => {
                    footerCartCount.classList.remove('bounce-anim');
                }, 400);
            } else {
                footerCartCount.classList.add('hidden');
            }
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-20 animate-fade-in">
                        <div class="text-8xl mb-6 animate-float">üõí</div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Carrinho vazio</h3>
                        <p class="text-gray-500 dark:text-gray-400">Adicione produtos para come√ßar suas compras</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="flex items-center space-x-4 py-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 animate-fade-in hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors px-2">
                        <div class="flex-shrink-0 w-16 h-16 bg-gray-200 dark:bg-gray-600 rounded-xl overflow-hidden">
                            ${item.image ? 
                                `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">` :
                                `<div class="w-full h-full flex items-center justify-center text-gray-400 text-xl">
                                    üñºÔ∏è
                                </div>`
                            }
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-gray-900 dark:text-gray-100 truncate">${item.name}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${formatPrice(item.price)}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity('${item.id}', -1)" class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center hover-lift">
                                ‚ûñ
                            </button>
                            <span class="w-8 text-center font-medium">${item.quantity}</span>
                            <button onclick="updateQuantity('${item.id}', 1)" class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center hover-lift">
                                ‚ûï
                            </button>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700 hover-lift p-2">
                            üóëÔ∏è
                        </button>
                    </div>
                `).join('');
            }
        }

        // Product detail functions
        window.showProductDetail = function(productId) {
            const product = products[productId];
            if (!product) return;
            
            const detailModalTitle = document.getElementById('detailModalTitle');
            const detailName = document.getElementById('detailName');
            const detailCategory = document.getElementById('detailCategory');
            const detailPrice = document.getElementById('detailPrice');
            const detailOldPrice = document.getElementById('detailOldPrice');
            const detailDiscount = document.getElementById('detailDiscount');
            const detailStock = document.getElementById('detailStock');
            const detailDescription = document.getElementById('detailDescription');
            const detailDescriptionContainer = document.getElementById('detailDescriptionContainer');
            const detailImage = document.getElementById('detailImage');
            const detailFavoriteBtn = document.getElementById('detailFavoriteBtn');
            const detailFavoriteIcon = document.getElementById('detailFavoriteIcon');
            const detailAddToCartBtn = document.getElementById('detailAddToCartBtn');
            
            detailModalTitle.textContent = 'Detalhes do Produto';
            detailName.textContent = product.name;
            detailCategory.textContent = getCategoryName(product.category);
            detailPrice.textContent = formatPrice(product.price);
            
            if (product.oldPrice && product.oldPrice > product.price) {
                const discountPercent = Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100);
                detailOldPrice.textContent = formatPrice(product.oldPrice);
                detailOldPrice.classList.remove('hidden');
                detailDiscount.textContent = `-${discountPercent}%`;
                detailDiscount.classList.remove('hidden');
            } else {
                detailOldPrice.classList.add('hidden');
                detailDiscount.classList.add('hidden');
            }
            
            if (product.stock > 0) {
                detailStock.innerHTML = `<span class="mr-2">‚úÖ</span>${product.stock} unidades em estoque`;
                detailAddToCartBtn.disabled = false;
                detailAddToCartBtn.innerHTML = '<span class="mr-2">üõí</span>Adicionar ao Carrinho';
            } else {
                detailStock.innerHTML = '<span class="mr-2">‚ùå</span>Produto esgotado';
                detailAddToCartBtn.disabled = true;
                detailAddToCartBtn.innerHTML = '<span class="mr-2">üö´</span>Sem Estoque';
            }
            
            if (product.description && product.description.trim()) {
                detailDescription.textContent = product.description;
                detailDescriptionContainer.classList.remove('hidden');
            } else {
                detailDescriptionContainer.classList.add('hidden');
            }
            
            if (product.image) {
                detailImage.innerHTML = `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-contain rounded-2xl">`;
            } else {
                detailImage.innerHTML = '<div class="text-6xl text-gray-400">üñºÔ∏è</div>';
            }

            window._currentDetailProductId = productId;
            const isFavorite = currentUser && favorites.includes(productId);
            detailFavoriteIcon.textContent = isFavorite ? '‚ù§Ô∏è' : 'ü§ç';
            detailFavoriteBtn.onclick = () => toggleFavorite(productId);
            detailFavoriteBtn.style.display = '';
            
            detailAddToCartBtn.onclick = () => {
                if (product.stock > 0) {
                    addToCart(productId);
                    closeProductDetail();
                }
            };
            
            productDetailModal.classList.remove('hidden');
            productDetailModal.style.opacity = '0';
            productDetailModal.style.transform = 'translateY(24px)';
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    productDetailModal.style.opacity = '1';
                    productDetailModal.style.transform = 'translateY(0)';
                });
            });
        };

        function closeProductDetail() {
            productDetailModal.style.opacity = '0';
            productDetailModal.style.transform = 'translateY(24px)';
            setTimeout(() => {
                productDetailModal.classList.add('hidden');
                productDetailModal.style.opacity = '';
                productDetailModal.style.transform = '';
            }, 300);
        }

        window.filterByCategory = function(category) {
            showSection('home');
            
            document.querySelectorAll('.category-filter-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'text-white');
                btn.classList.add('btn-secondary');
            });
            
            const categoryBtn = document.querySelector(`.category-filter-btn[data-category="${category}"]`);
            if (categoryBtn) {
                categoryBtn.classList.remove('btn-secondary');
                categoryBtn.classList.add('btn-primary', 'text-white');
            }
            
            renderProducts();
        };

        function filterProducts() {
            renderProducts();
        }

        // Profile picture modal functionality
        window.openProfilePictureModal = function() {
            if (!currentUser || isGuest) {
                showNotificationToast('Aviso', 'Fa√ßa login para alterar sua foto de perfil', 'warning');
                return;
            }
            
            const profilePicturePreview = document.getElementById('profilePicturePreview');
            profilePicturePreview.src = currentUser.photoURL || 'https://via.placeholder.com/128?text=üë§';
            uploadedPhotoURL = null;
            document.getElementById('saveProfilePictureBtn').disabled = true;
            const ppModal = document.getElementById('profilePictureModal');
            ppModal.classList.remove('hidden');
            ppModal.style.opacity = '0';
            ppModal.style.transform = 'translateY(24px)';
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    ppModal.style.opacity = '1';
                    ppModal.style.transform = 'translateY(0)';
                });
            });
        };

        const newProfilePicture = document.getElementById('newProfilePicture');
        const profilePicturePreview = document.getElementById('profilePicturePreview');
        const saveProfilePictureBtn = document.getElementById('saveProfilePictureBtn');
        const saveProfilePictureText = document.getElementById('saveProfilePictureText');
        const saveProfilePictureLoader = document.getElementById('saveProfilePictureLoader');

        newProfilePicture.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                profilePicturePreview.src = e.target.result;
                saveProfilePictureBtn.disabled = false;
            };
            reader.readAsDataURL(file);

            // Upload to ImgBB
            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    uploadedPhotoURL = result.data.url;
                    console.log('Profile image uploaded successfully:', uploadedPhotoURL);
                } else {
                    showNotificationToast('Erro', 'Erro ao fazer upload da imagem.', 'error');
                    saveProfilePictureBtn.disabled = true;
                }
            } catch (error) {
                console.error('Image upload error:', error);
                showNotificationToast('Erro', 'Erro ao fazer upload da imagem.', 'error');
                saveProfilePictureBtn.disabled = true;
            }
        });

        saveProfilePictureBtn.addEventListener('click', async () => {
            if (!uploadedPhotoURL || !currentUser) return;

            // Show loading state
            saveProfilePictureText.classList.add('hidden');
            saveProfilePictureLoader.classList.remove('hidden');
            saveProfilePictureBtn.disabled = true;

            try {
                // Update profile photo in Firebase Auth
                await updateProfile(currentUser, {
                    photoURL: uploadedPhotoURL
                });

                // Update in Firestore
                await setDoc(doc(firestore, 'users', currentUser.uid), {
                    photoURL: uploadedPhotoURL,
                    updatedAt: new Date()
                }, { merge: true });

                // Update in Realtime Database
                await update(ref(database, `users/${currentUser.uid}`), {
                    photoURL: uploadedPhotoURL,
                    updatedAt: Date.now()
                });

                // Update UI
                document.getElementById('userAvatar').src = uploadedPhotoURL;
                document.getElementById('profileAvatar').src = uploadedPhotoURL;

                showNotificationToast('Sucesso', 'Foto de perfil atualizada com sucesso!', 'success');
                closeProfilePictureModal();
            } catch (error) {
                console.error('Error updating profile picture:', error);
                showNotificationToast('Erro', 'Erro ao atualizar foto de perfil. Tente novamente.', 'error');
            } finally {
                // Reset loading state
                saveProfilePictureText.classList.remove('hidden');
                saveProfilePictureLoader.classList.add('hidden');
                saveProfilePictureBtn.disabled = false;
            }
        });

        function closeProfilePictureModal() {
            const ppModal = document.getElementById('profilePictureModal');
            ppModal.style.opacity = '0';
            ppModal.style.transform = 'translateY(24px)';
            setTimeout(() => {
                ppModal.classList.add('hidden');
                ppModal.style.opacity = '';
                ppModal.style.transform = '';
            }, 300);
            uploadedPhotoURL = null;
        }

        document.getElementById('closeProfilePictureBtn').addEventListener('click', closeProfilePictureModal);
        document.getElementById('cancelProfilePictureBtn').addEventListener('click', closeProfilePictureModal);

        // Utility functions
        function formatPrice(price) {
            return `${Math.round(price).toLocaleString('pt-AO')} Kz`;
        }

        function getCategoryName(category) {
            const categoryNames = {
                'eletronicos': 'Eletr√¥nicos',
                'roupas': 'Roupas',
                'casa': 'Casa e Jardim',
                'livros': 'Livros',
                'esportes': 'Esportes',
                'beleza': 'Beleza',
                'acessorios': 'Acess√≥rios & Joias',
                'calcados': 'Cal√ßados',
                'alimentacao': 'Alimenta√ß√£o & Bebidas',
                'saude': 'Sa√∫de & Bem-estar',
                'automotivo': 'Automotivo',
                'brinquedos': 'Brinquedos & Jogos',
                'musica': 'M√∫sica & Instrumentos',
                'arte': 'Arte & Artesanato',
                'pets': 'Pets',
                'servicos': 'Servi√ßos'
            };
            return categoryNames[category] || category;
        }

        function getCategoryIcon(category) {
            const categoryIcons = {
                'eletronicos': 'üíª',
                'roupas': 'üëï',
                'casa': 'üè†',
                'livros': 'üìö',
                'esportes': '‚öΩ',
                'beleza': 'üíÑ',
                'acessorios': 'üíç',
                'calcados': 'üëü',
                'alimentacao': 'üçî',
                'saude': 'üíä',
                'automotivo': 'üöó',
                'brinquedos': 'üß∏',
                'musica': 'üé∏',
                'arte': 'üé®',
                'pets': 'üê∂',
                'servicos': 'üõ†Ô∏è'
            };
            return categoryIcons[category] || 'üóÇÔ∏è';
        }

        function getCategoryBackground(category) {
            const bgs = {
                'eletronicos': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23141E30'/%3E%3Cstop offset='1' stop-color='%23243B55'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='320' cy='60' r='80' fill='%230ea5e9' opacity='.18'/%3E%3Ccircle cx='80' cy='220' r='100' fill='%236366f1' opacity='.15'/%3E%3Crect x='150' y='80' width='120' height='80' rx='12' fill='%2338bdf8' opacity='.12'/%3E%3Cline x1='0' y1='150' x2='400' y2='150' stroke='%2338bdf8' stroke-width='.5' opacity='.15'/%3E%3Cline x1='200' y1='0' x2='200' y2='300' stroke='%2338bdf8' stroke-width='.5' opacity='.1'/%3E%3C/svg%3E\")",
                'roupas': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23831843'/%3E%3Cstop offset='1' stop-color='%23be185d'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='340' cy='250' r='120' fill='%23ec4899' opacity='.15'/%3E%3Ccircle cx='60' cy='40' r='80' fill='%23f472b6' opacity='.12'/%3E%3Cpath d='M100 300 Q200 180 300 300' fill='%23fda4af' opacity='.08'/%3E%3Crect x='180' y='60' width='60' height='100' rx='30' fill='%23fb7185' opacity='.1'/%3E%3C/svg%3E\")",
                'casa': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23064e3b'/%3E%3Cstop offset='1' stop-color='%23065f46'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='100' cy='80' r='60' fill='%2334d399' opacity='.12'/%3E%3Ccircle cx='330' cy='220' r='90' fill='%2310b981' opacity='.1'/%3E%3Cpath d='M200 50 L280 120 L120 120Z' fill='%236ee7b7' opacity='.1'/%3E%3Crect x='160' y='120' width='80' height='80' fill='%23a7f3d0' opacity='.06'/%3E%3C/svg%3E\")",
                'livros': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%2378350f'/%3E%3Cstop offset='1' stop-color='%2392400e'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Crect x='50' y='80' width='40' height='160' rx='4' fill='%23fbbf24' opacity='.15'/%3E%3Crect x='100' y='60' width='35' height='180' rx='4' fill='%23f59e0b' opacity='.12'/%3E%3Crect x='145' y='90' width='38' height='150' rx='4' fill='%23fcd34d' opacity='.1'/%3E%3Ccircle cx='320' cy='80' r='60' fill='%23fbbf24' opacity='.08'/%3E%3Ccircle cx='300' cy='240' r='80' fill='%23f59e0b' opacity='.07'/%3E%3C/svg%3E\")",
                'esportes': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23172554'/%3E%3Cstop offset='1' stop-color='%231e3a5f'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='200' cy='150' r='70' fill='none' stroke='%2360a5fa' stroke-width='3' opacity='.2'/%3E%3Ccircle cx='80' cy='60' r='50' fill='%233b82f6' opacity='.1'/%3E%3Ccircle cx='350' cy='250' r='70' fill='%232563eb' opacity='.12'/%3E%3Cpath d='M50 200 Q150 100 250 200 T450 200' fill='none' stroke='%2393c5fd' stroke-width='1.5' opacity='.12'/%3E%3C/svg%3E\")",
                'beleza': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%234a044e'/%3E%3Cstop offset='1' stop-color='%2386198f'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='100' cy='100' r='80' fill='%23d946ef' opacity='.12'/%3E%3Ccircle cx='320' cy='60' r='50' fill='%23e879f9' opacity='.1'/%3E%3Ccircle cx='280' cy='230' r='90' fill='%23a855f7' opacity='.1'/%3E%3Cellipse cx='180' cy='200' rx='60' ry='40' fill='%23f0abfc' opacity='.08'/%3E%3C/svg%3E\")",
                'acessorios': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%2344403c'/%3E%3Cstop offset='1' stop-color='%2357534e'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='200' cy='140' r='50' fill='%23fbbf24' opacity='.15'/%3E%3Ccircle cx='200' cy='140' r='35' fill='%2344403c'/%3E%3Ccircle cx='80' cy='60' r='40' fill='%23f59e0b' opacity='.08'/%3E%3Ccircle cx='340' cy='240' r='60' fill='%23d97706' opacity='.1'/%3E%3Cpath d='M160 100 Q200 60 240 100' fill='none' stroke='%23fbbf24' stroke-width='2' opacity='.2'/%3E%3C/svg%3E\")",
                'calcados': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%231c1917'/%3E%3Cstop offset='1' stop-color='%23292524'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Cellipse cx='200' cy='180' rx='130' ry='40' fill='%23f97316' opacity='.1'/%3E%3Ccircle cx='100' cy='80' r='60' fill='%23fb923c' opacity='.08'/%3E%3Ccircle cx='330' cy='100' r='50' fill='%23ea580c' opacity='.1'/%3E%3Cpath d='M60 220 Q200 160 340 220' fill='none' stroke='%23fdba74' stroke-width='2' opacity='.15'/%3E%3C/svg%3E\")",
                'alimentacao': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%237f1d1d'/%3E%3Cstop offset='1' stop-color='%23991b1b'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='140' cy='120' r='70' fill='%23ef4444' opacity='.12'/%3E%3Ccircle cx='300' cy='200' r='90' fill='%23f87171' opacity='.08'/%3E%3Ccircle cx='60' cy='250' r='40' fill='%23fca5a5' opacity='.1'/%3E%3Crect x='220' y='50' width='100' height='60' rx='30' fill='%23fecaca' opacity='.06'/%3E%3C/svg%3E\")",
                'saude': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23042f2e'/%3E%3Cstop offset='1' stop-color='%23134e4a'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Crect x='175' y='80' width='50' height='140' rx='6' fill='%232dd4bf' opacity='.12'/%3E%3Crect x='130' y='125' width='140' height='50' rx='6' fill='%232dd4bf' opacity='.12'/%3E%3Ccircle cx='80' cy='60' r='50' fill='%2314b8a6' opacity='.08'/%3E%3Ccircle cx='340' cy='250' r='60' fill='%235eead4' opacity='.07'/%3E%3C/svg%3E\")",
                'automotivo': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%231e293b'/%3E%3Cstop offset='1' stop-color='%23334155'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='130' cy='200' r='50' fill='none' stroke='%2394a3b8' stroke-width='6' opacity='.15'/%3E%3Ccircle cx='280' cy='200' r='50' fill='none' stroke='%2394a3b8' stroke-width='6' opacity='.15'/%3E%3Crect x='80' y='130' width='250' height='70' rx='20' fill='%2364748b' opacity='.1'/%3E%3Ccircle cx='320' cy='60' r='40' fill='%23475569' opacity='.12'/%3E%3C/svg%3E\")",
                'brinquedos': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23701a75'/%3E%3Cstop offset='1' stop-color='%23a21caf'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='100' cy='80' r='40' fill='%23f472b6' opacity='.15'/%3E%3Ccircle cx='300' cy='100' r='55' fill='%2338bdf8' opacity='.12'/%3E%3Ccircle cx='200' cy='230' r='60' fill='%23a3e635' opacity='.1'/%3E%3Crect x='150' y='50' width='30' height='30' rx='4' fill='%23fbbf24' opacity='.15' transform='rotate(15 165 65)'/%3E%3Crect x='280' y='200' width='25' height='25' rx='4' fill='%23fb7185' opacity='.15' transform='rotate(-20 292 212)'/%3E%3C/svg%3E\")",
                'musica': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23312e81'/%3E%3Cstop offset='1' stop-color='%234338ca'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='280' cy='200' r='50' fill='%23818cf8' opacity='.15'/%3E%3Cline x1='280' y1='200' x2='280' y2='60' stroke='%23a5b4fc' stroke-width='3' opacity='.15'/%3E%3Ccircle cx='100' cy='100' r='70' fill='%236366f1' opacity='.1'/%3E%3Cpath d='M50 250 Q120 200 190 250 Q260 300 330 250' fill='none' stroke='%23c7d2fe' stroke-width='1.5' opacity='.12'/%3E%3C/svg%3E\")",
                'arte': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%239d174d'/%3E%3Cstop offset='1' stop-color='%23be185d'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='80' cy='80' r='50' fill='%23fbbf24' opacity='.15'/%3E%3Ccircle cx='200' cy='200' r='60' fill='%233b82f6' opacity='.12'/%3E%3Ccircle cx='320' cy='100' r='45' fill='%2322c55e' opacity='.12'/%3E%3Crect x='260' y='200' width='80' height='60' rx='4' fill='%23e879f9' opacity='.1'/%3E%3Cpath d='M40 280 Q100 180 180 250' fill='none' stroke='%23fcd34d' stroke-width='3' opacity='.15'/%3E%3C/svg%3E\")",
                'pets': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23365314'/%3E%3Cstop offset='1' stop-color='%233f6212'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='160' cy='120' r='30' fill='%2384cc16' opacity='.15'/%3E%3Ccircle cx='240' cy='120' r='30' fill='%2384cc16' opacity='.15'/%3E%3Ccircle cx='200' cy='170' r='50' fill='%23a3e635' opacity='.1'/%3E%3Ccircle cx='80' cy='60' r='20' fill='%23bef264' opacity='.1'/%3E%3Ccircle cx='340' cy='50' r='20' fill='%23bef264' opacity='.1'/%3E%3Ccircle cx='60' cy='260' r='50' fill='%234ade80' opacity='.07'/%3E%3C/svg%3E\")",
                'servicos': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23374151'/%3E%3Cstop offset='1' stop-color='%234b5563'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='200' cy='130' r='60' fill='%239ca3af' opacity='.1'/%3E%3Crect x='180' y='100' width='40' height='60' rx='4' fill='%23d1d5db' opacity='.1'/%3E%3Ccircle cx='80' cy='240' r='50' fill='%236b7280' opacity='.1'/%3E%3Ccircle cx='340' cy='80' r='40' fill='%239ca3af' opacity='.08'/%3E%3Cpath d='M100 50 L350 250' stroke='%23d1d5db' stroke-width='1' opacity='.08'/%3E%3C/svg%3E\")"
            };
            const fallback = "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23374151'/%3E%3Cstop offset='1' stop-color='%234b5563'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='400' height='300'/%3E%3Ccircle cx='200' cy='150' r='80' fill='%236b7280' opacity='.1'/%3E%3Ccircle cx='80' cy='60' r='40' fill='%239ca3af' opacity='.08'/%3E%3C/svg%3E\")";
            return bgs[category] || fallback;
        }

        function showMainApp() {
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                loginScreen.classList.add('hidden');
                mainApp.classList.remove('hidden');
                mainApp.style.opacity = '0';
                setTimeout(() => {
                    mainApp.style.opacity = '1';
                    updateSearchVisibility();
                }, 50);
            }, 300);
        }

        function showLoginScreen() {
            loadingScreen.classList.add('hidden');
            mainApp.classList.add('hidden');
            loginScreen.classList.remove('hidden');

            loginOptions.classList.remove('hidden');
            emailLoginForm.classList.add('hidden');
            emailRegisterForm.classList.add('hidden');

            // Reset error banner
            const errorBanner = document.getElementById('loginErrorBanner');
            if (errorBanner) errorBanner.classList.add('hidden');
        }

        // Make functions available globally
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;
        window.showLoginScreen = showLoginScreen;
        window.showSection = showSection;

        // Setup filter toggles
        setupFilterToggles();
        setupHeaderFilterToggle();

        // Initialize the app
        setTimeout(() => {
            if (!currentUser && !isGuest) {
                showLoginScreen();
            }
        }, 2000);
    </script>
    <script>
  // Espera 3 segundos (3000 ms)
  setTimeout(function() {
    // Seleciona os elementos pelos IDs
    const priceBtn = document.getElementById("togglePriceFilters");
    const categoryBtn = document.getElementById("toggleCategoryFilters");

    // Se existirem, dispara o clique
    if (priceBtn) priceBtn.click();
    if (categoryBtn) categoryBtn.click();
  }, 3000);
</script>
</body>
</html>